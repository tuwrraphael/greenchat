!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=56)}([function(e,t,n){"use strict";(function(e){function r(t){return void 0!==e&&e.isBuffer(t)?new Uint8Array(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return a}));class i{static ToString(e,t="utf8"){const n=r(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(t){const n=r(t);if("undefined"!=typeof btoa){const e=this.ToString(n,"binary");return btoa(e)}return e.from(n).toString("base64")}static FromBase64(t){return t=t.replace(/\n/g,"").replace(/\r/g,"").replace(/\t/g,"").replace(/\s/g,""),"undefined"!=typeof atob?this.FromBinary(atob(t)):new Uint8Array(e.from(t,"base64")).buffer}static FromBase64Url(e){return this.FromBase64(this.Base64Padding(e.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n.buffer}static ToUtf8String(e){const t=r(e),n=String.fromCharCode.apply(null,t);return decodeURIComponent(escape(n))}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return n.buffer}static ToBinary(e){const t=r(e);let n="";const i=t.length;for(let e=0;e<i;e++)n+=String.fromCharCode(t[e]);return n}static ToHex(e){const t=r(e),n=[],i=t.length;for(let e=0;e<i;e++){const r=t[e].toString(16);n.push(1===r.length?"0"+r:r)}return n.join("")}static FromHex(e){const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const r=e.slice(n,n+2);t[n/2]=parseInt(r,16)}return t.buffer}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}}function s(e,...t){const n=arguments[0];for(let e=1;e<arguments.length;e++){const t=arguments[e];for(const e in t)n[e]=t[e]}return n}function o(...e){const t=e.map(e=>e.byteLength).reduce((e,t)=>e+t),n=new Uint8Array(t);let r=0;return e.map(e=>new Uint8Array(e)).forEach(e=>{for(const t of e)n[r++]=t}),n.buffer}function a(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;const n=new Uint8Array(e),r=new Uint8Array(t);for(let t=0;t<e.byteLength;t++)if(n[t]!==r[t])return!1;return!0}}).call(this,n(35).Buffer)},function(e,t,n){"use strict";var r,i,s=e.exports=n(3),o=n(22);s.codegen=n(51),s.fetch=n(52),s.path=n(53),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),n=new Array(t.length),r=0;r<t.length;)n[r]=e[t[r++]];return n}return[]},s.toObject=function(e){for(var t={},n=0;n<e.length;){var r=e[n++],i=e[n++];void 0!==i&&(t[r]=i)}return t};var a=/\\/g,c=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(a,"\\\\").replace(c,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,(function(e,t){return t.toUpperCase()}))},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(s.decorateRoot.remove(e.$type),e.$type.name=t,s.decorateRoot.add(e.$type)),e.$type;r||(r=n(11));var i=new r(t||e.name);return s.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var h=0;s.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=n(2));var t=new i("Enum"+h++,e);return s.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},Object.defineProperty(s,"decorateRoot",{get:function(){return o.decorated||(o.decorated=new(n(16)))}})},function(e,t,n){"use strict";e.exports=o;var r=n(5);((o.prototype=Object.create(r.prototype)).constructor=o).className="Enum";var i=n(7),s=n(1);function o(e,t,n,i,s){if(r.call(this,e,n),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.reserved=void 0,t)for(var o=Object.keys(t),a=0;a<o.length;++a)"number"==typeof t[o[a]]&&(this.valuesById[this.values[o[a]]=t[o[a]]]=o[a])}o.fromJSON=function(e,t){var n=new o(e,t.values,t.options,t.comment,t.comments);return n.reserved=t.reserved,n},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return s.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},o.prototype.add=function(e,t,n){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return this.comments[e]=n||null,this},o.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this},o.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},o.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},function(e,t,n){"use strict";(function(e){var r=t;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function s(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&i(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}r.asPromise=n(19),r.base64=n(42),r.EventEmitter=n(43),r.float=n(44),r.inquire=n(20),r.utf8=n(45),r.pool=n(46),r.LongBits=n(47),r.global="undefined"!=typeof window&&window||void 0!==e&&e||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isNode=Boolean(r.global.process&&r.global.process.versions&&r.global.process.versions.node),r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=s,r.ProtocolError=s("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}}).call(this,n(18))},function(e,t,n){"use strict";e.exports=u;var r=n(5);((u.prototype=Object.create(r.prototype)).constructor=u).className="Field";var i,s=n(2),o=n(6),a=n(1),c=/^required|optional|repeated$/;function u(e,t,n,i,s,u,h){if(a.isObject(i)?(h=s,u=i,i=s=void 0):a.isObject(s)&&(h=u,u=s,s=void 0),r.call(this,e,u),!a.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!a.isString(n))throw TypeError("type must be a string");if(void 0!==i&&!c.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!a.isString(s))throw TypeError("extend must be a string");this.rule=i&&"optional"!==i?i:void 0,this.type=n,this.id=t,this.extend=s||void 0,this.required="required"===i,this.optional=!this.required,this.repeated="repeated"===i,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!a.Long&&void 0!==o.long[n],this.bytes="bytes"===n,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=h}u.fromJSON=function(e,t){return new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(e,t,n){return"packed"===e&&(this._packed=null),r.prototype.setOption.call(this,e,t,n)},u.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return a.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=o.defaults[this.type])&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof i?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=a.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;a.base64.test(this.typeDefault)?a.base64.decode(this.typeDefault,e=a.newBuffer(a.base64.length(this.typeDefault)),0):a.utf8.write(this.typeDefault,e=a.newBuffer(a.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=a.emptyObject:this.repeated?this.defaultValue=a.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof i&&(this.parent.ctor.prototype[this.name]=this.defaultValue),r.prototype.resolve.call(this)},u.d=function(e,t,n,r){return"function"==typeof t?t=a.decorateType(t).name:t&&"object"==typeof t&&(t=a.decorateEnum(t).name),function(i,s){a.decorateType(i.constructor).add(new u(s,e,t,n,{default:r}))}},u._configure=function(e){i=e}},function(e,t,n){"use strict";e.exports=s,s.className="ReflectionObject";var r,i=n(1);function s(e,t){if(!i.isString(e))throw TypeError("name must be a string");if(t&&!i.isObject(t))throw TypeError("options must be an object");this.options=t,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(s.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),s.prototype.toJSON=function(){throw Error()},s.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof r&&t._handleAdd(this)},s.prototype.onRemove=function(e){var t=e.root;t instanceof r&&t._handleRemove(this),this.parent=null,this.resolved=!1},s.prototype.resolve=function(){return this.resolved||this.root instanceof r&&(this.resolved=!0),this},s.prototype.getOption=function(e){if(this.options)return this.options[e]},s.prototype.setOption=function(e,t,n){return n&&this.options&&void 0!==this.options[e]||((this.options||(this.options={}))[e]=t),this},s.prototype.setOptions=function(e,t){if(e)for(var n=Object.keys(e),r=0;r<n.length;++r)this.setOption(n[r],e[n[r]],t);return this},s.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},s._configure=function(e){r=e}},function(e,t,n){"use strict";var r=t,i=n(1),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function o(e,t){var n=0,r={};for(t|=0;n<e.length;)r[s[n+t]]=e[n++];return r}r.basic=o([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),r.defaults=o([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),r.long=o([0,0,0,1,1],7),r.mapKey=o([0,0,0,5,5,0,0,0,1,1,0,2],2),r.packed=o([1,5,0,0,0,5,5,0,0,0,1,1,0])},function(e,t,n){"use strict";e.exports=h;var r=n(5);((h.prototype=Object.create(r.prototype)).constructor=h).className="Namespace";var i,s,o,a=n(4),c=n(1);function u(e,t){if(e&&e.length){for(var n={},r=0;r<e.length;++r)n[e[r].name]=e[r].toJSON(t);return n}}function h(e,t){r.call(this,e,t),this.nested=void 0,this._nestedArray=null}function l(e){return e._nestedArray=null,e}h.fromJSON=function(e,t){return new h(e,t.options).addJSON(t.nested)},h.arrayToJSON=u,h.isReservedId=function(e,t){if(e)for(var n=0;n<e.length;++n)if("string"!=typeof e[n]&&e[n][0]<=t&&e[n][1]>t)return!0;return!1},h.isReservedName=function(e,t){if(e)for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=c.toArray(this.nested))}}),h.prototype.toJSON=function(e){return c.toObject(["options",this.options,"nested",u(this.nestedArray,e)])},h.prototype.addJSON=function(e){if(e)for(var t,n=Object.keys(e),r=0;r<n.length;++r)t=e[n[r]],this.add((void 0!==t.fields?i.fromJSON:void 0!==t.values?o.fromJSON:void 0!==t.methods?s.fromJSON:void 0!==t.id?a.fromJSON:h.fromJSON)(n[r],t));return this},h.prototype.get=function(e){return this.nested&&this.nested[e]||null},h.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof o)return this.nested[e].values;throw Error("no such enum: "+e)},h.prototype.add=function(e){if(!(e instanceof a&&void 0!==e.extend||e instanceof i||e instanceof o||e instanceof s||e instanceof h))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(!(t instanceof h&&e instanceof h)||t instanceof i||t instanceof s)throw Error("duplicate name '"+e.name+"' in "+this);for(var n=t.nestedArray,r=0;r<n.length;++r)e.add(n[r]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),l(this)},h.prototype.remove=function(e){if(!(e instanceof r))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),l(this)},h.prototype.define=function(e,t){if(c.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var n=this;e.length>0;){var r=e.shift();if(n.nested&&n.nested[r]){if(!((n=n.nested[r])instanceof h))throw Error("path conflicts with non-namespace objects")}else n.add(n=new h(r))}return t&&n.addJSON(t),n},h.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof h?e[t++].resolveAll():e[t++].resolve();return this.resolve()},h.prototype.lookup=function(e,t,n){if("boolean"==typeof t?(n=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),c.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var r=this.get(e[0]);if(r){if(1===e.length){if(!t||t.indexOf(r.constructor)>-1)return r}else if(r instanceof h&&(r=r.lookup(e.slice(1),t,!0)))return r}else for(var i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof h&&(r=this._nestedArray[i].lookup(e,t,!0)))return r;return null===this.parent||n?null:this.parent.lookup(e,t)},h.prototype.lookupType=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such type: "+e);return t},h.prototype.lookupEnum=function(e){var t=this.lookup(e,[o]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},h.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[i,o]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},h.prototype.lookupService=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},h._configure=function(e,t,n){i=e,s=t,o=n}},function(e,t,n){"use strict";e.exports=o;var r=n(5);((o.prototype=Object.create(r.prototype)).constructor=o).className="OneOf";var i=n(4),s=n(1);function o(e,t,n,i){if(Array.isArray(t)||(n=t,t=void 0),r.call(this,e,n),void 0!==t&&!Array.isArray(t))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function a(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}o.fromJSON=function(e,t){return new o(e,t.oneof,t.options,t.comment)},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},o.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,a(this),this},o.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},o.prototype.onAdd=function(e){r.prototype.onAdd.call(this,e);for(var t=0;t<this.oneof.length;++t){var n=e.get(this.oneof[t]);n&&!n.partOf&&(n.partOf=this,this.fieldsArray.push(n))}a(this)},o.prototype.onRemove=function(e){for(var t,n=0;n<this.fieldsArray.length;++n)(t=this.fieldsArray[n]).parent&&t.parent.remove(t);r.prototype.onRemove.call(this,e)},o.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,n){s.decorateType(t.constructor).add(new o(n,e)),Object.defineProperty(t,n,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},function(e,t,n){"use strict";e.exports=l;var r,i=n(3),s=i.LongBits,o=i.base64,a=i.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function h(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function l(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var f=function(){return i.Buffer?function(){return(l.create=function(){return new r})()}:function(){return new l}};function p(e,t,n){t[n]=255&e}function d(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}l.create=f(),l.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(l.alloc=i.pool(l.alloc,i.Array.prototype.subarray)),l.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},d.prototype=Object.create(c.prototype),d.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},l.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new d((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},l.prototype.int32=function(e){return e<0?this._push(y,10,s.fromNumber(e)):this.uint32(e)},l.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},l.prototype.uint64=function(e){var t=s.from(e);return this._push(y,t.length(),t)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(y,t.length(),t)},l.prototype.bool=function(e){return this._push(p,1,e?1:0)},l.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(e){var t=s.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},l.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};l.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){var n=l.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(v,t,e)},l.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},l.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new c(u,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},l.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},l.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},l._configure=function(e){r=e,l.create=f(),r._configure()}},function(e,t,n){"use strict";e.exports=c;var r,i=n(3),s=i.LongBits,o=i.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,h="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},l=function(){return i.Buffer?function(e){return(c.create=function(e){return i.Buffer.isBuffer(e)?new r(e):h(e)})(e)}:h};function f(){var e=new s(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new s(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}c.create=l(),c.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){r=e,c.create=l(),r._configure();var t=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},function(e,t,n){"use strict";e.exports=m;var r=n(7);((m.prototype=Object.create(r.prototype)).constructor=m).className="Type";var i=n(2),s=n(8),o=n(4),a=n(12),c=n(13),u=n(15),h=n(10),l=n(9),f=n(1),p=n(23),d=n(24),y=n(25),g=n(26),v=n(27);function m(e,t){r.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function w(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(m.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var n=this.fields[e[t]],r=n.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=n}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=f.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=f.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=m.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,f.merge(e.prototype,t)),e.$type=e.prototype.$type=this,f.merge(e,u,!0),this._ctor=e;for(var n=0;n<this.fieldsArray.length;++n)this._fieldsArray[n].resolve();var r={};for(n=0;n<this.oneofsArray.length;++n)r[this._oneofsArray[n].resolve().name]={get:f.oneOfGetter(this._oneofsArray[n].oneof),set:f.oneOfSetter(this._oneofsArray[n].oneof)};n&&Object.defineProperties(e.prototype,r)}}}),m.generateConstructor=function(e){for(var t,n=f.codegen(["p"],e.name),r=0;r<e.fieldsArray.length;++r)(t=e._fieldsArray[r]).map?n("this%s={}",f.safeProp(t.name)):t.repeated&&n("this%s=[]",f.safeProp(t.name));return n("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},m.fromJSON=function(e,t){var n=new m(e,t.options);n.extensions=t.extensions,n.reserved=t.reserved;for(var u=Object.keys(t.fields),h=0;h<u.length;++h)n.add((void 0!==t.fields[u[h]].keyType?a.fromJSON:o.fromJSON)(u[h],t.fields[u[h]]));if(t.oneofs)for(u=Object.keys(t.oneofs),h=0;h<u.length;++h)n.add(s.fromJSON(u[h],t.oneofs[u[h]]));if(t.nested)for(u=Object.keys(t.nested),h=0;h<u.length;++h){var l=t.nested[u[h]];n.add((void 0!==l.id?o.fromJSON:void 0!==l.fields?m.fromJSON:void 0!==l.values?i.fromJSON:void 0!==l.methods?c.fromJSON:r.fromJSON)(u[h],l))}return t.extensions&&t.extensions.length&&(n.extensions=t.extensions),t.reserved&&t.reserved.length&&(n.reserved=t.reserved),t.group&&(n.group=!0),t.comment&&(n.comment=t.comment),n},m.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&Boolean(e.keepComments);return f.toObject(["options",t&&t.options||void 0,"oneofs",r.arrayToJSON(this.oneofsArray,e),"fields",r.arrayToJSON(this.fieldsArray.filter((function(e){return!e.declaringField})),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},m.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var n=this.oneofsArray;for(t=0;t<n.length;)n[t++].resolve();return r.prototype.resolveAll.call(this)},m.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},m.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof o&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),w(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),w(this)):r.prototype.add.call(this,e)},m.prototype.remove=function(e){if(e instanceof o&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),w(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),w(this)}return r.prototype.remove.call(this,e)},m.prototype.isReservedId=function(e){return r.isReservedId(this.reserved,e)},m.prototype.isReservedName=function(e){return r.isReservedName(this.reserved,e)},m.prototype.create=function(e){return new this.ctor(e)},m.prototype.setup=function(){for(var e=this.fullName,t=[],n=0;n<this.fieldsArray.length;++n)t.push(this._fieldsArray[n].resolve().resolvedType);this.encode=p(this)({Writer:l,types:t,util:f}),this.decode=d(this)({Reader:h,types:t,util:f}),this.verify=y(this)({types:t,util:f}),this.fromObject=g.fromObject(this)({types:t,util:f}),this.toObject=g.toObject(this)({types:t,util:f});var r=v[e];if(r){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(i),i.toObject=this.toObject,this.toObject=r.toObject.bind(i)}return this},m.prototype.encode=function(e,t){return this.setup().encode(e,t)},m.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},m.prototype.decode=function(e,t){return this.setup().decode(e,t)},m.prototype.decodeDelimited=function(e){return e instanceof h||(e=h.create(e)),this.decode(e,e.uint32())},m.prototype.verify=function(e){return this.setup().verify(e)},m.prototype.fromObject=function(e){return this.setup().fromObject(e)},m.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},m.d=function(e){return function(t){f.decorateType(t,e)}}},function(e,t,n){"use strict";e.exports=o;var r=n(4);((o.prototype=Object.create(r.prototype)).constructor=o).className="MapField";var i=n(6),s=n(1);function o(e,t,n,i,o,a){if(r.call(this,e,t,i,void 0,void 0,o,a),!s.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}o.fromJSON=function(e,t){return new o(e,t.id,t.keyType,t.type,t.options,t.comment)},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},o.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return r.prototype.resolve.call(this)},o.d=function(e,t,n){return"function"==typeof n?n=s.decorateType(n).name:n&&"object"==typeof n&&(n=s.decorateEnum(n).name),function(r,i){s.decorateType(r.constructor).add(new o(i,e,t,n))}}},function(e,t,n){"use strict";e.exports=a;var r=n(7);((a.prototype=Object.create(r.prototype)).constructor=a).className="Service";var i=n(14),s=n(1),o=n(21);function a(e,t){r.call(this,e,t),this.methods={},this._methodsArray=null}function c(e){return e._methodsArray=null,e}a.fromJSON=function(e,t){var n=new a(e,t.options);if(t.methods)for(var r=Object.keys(t.methods),s=0;s<r.length;++s)n.add(i.fromJSON(r[s],t.methods[r[s]]));return t.nested&&n.addJSON(t.nested),n.comment=t.comment,n},a.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&Boolean(e.keepComments);return s.toObject(["options",t&&t.options||void 0,"methods",r.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},Object.defineProperty(a.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),a.prototype.get=function(e){return this.methods[e]||r.prototype.get.call(this,e)},a.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return r.prototype.resolve.call(this)},a.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,c(this)):r.prototype.add.call(this,e)},a.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,c(this)}return r.prototype.remove.call(this,e)},a.prototype.create=function(e,t,n){for(var r,i=new o.Service(e,t,n),a=0;a<this.methodsArray.length;++a){var c=s.lcFirst((r=this._methodsArray[a]).resolve().name).replace(/[^$\w_]/g,"");i[c]=s.codegen(["r","c"],s.isReserved(c)?c+"_":c)("return this.rpcCall(m,q,s,r,c)")({m:r,q:r.resolvedRequestType.ctor,s:r.resolvedResponseType.ctor})}return i}},function(e,t,n){"use strict";e.exports=s;var r=n(5);((s.prototype=Object.create(r.prototype)).constructor=s).className="Method";var i=n(1);function s(e,t,n,s,o,a,c,u){if(i.isObject(o)?(c=o,o=a=void 0):i.isObject(a)&&(c=a,a=void 0),void 0!==t&&!i.isString(t))throw TypeError("type must be a string");if(!i.isString(n))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");r.call(this,e,c),this.type=t||"rpc",this.requestType=n,this.requestStream=!!o||void 0,this.responseType=s,this.responseStream=!!a||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment)},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),r.prototype.resolve.call(this))}},function(e,t,n){"use strict";e.exports=i;var r=n(3);function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)this[t[n]]=e[t[n]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,r.toJSONOptions)}},function(e,t,n){"use strict";e.exports=l;var r=n(7);((l.prototype=Object.create(r.prototype)).constructor=l).className="Root";var i,s,o,a=n(4),c=n(2),u=n(8),h=n(1);function l(e){r.call(this,"",e),this.deferred=[],this.files=[]}function f(){}l.fromJSON=function(e,t){return t||(t=new l),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},l.prototype.resolvePath=h.path.resolve,l.prototype.load=function e(t,n,r){"function"==typeof n&&(r=n,n=void 0);var i=this;if(!r)return h.asPromise(e,i,t,n);var a=r===f;function c(e,t){if(r){var n=r;if(r=null,a)throw e;n(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var n=e.substring(t);if(n in o)return n}return null}function l(e,t){try{if(h.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),h.isString(t)){s.filename=e;var r,o=s(t,i,n),l=0;if(o.imports)for(;l<o.imports.length;++l)(r=u(o.imports[l])||i.resolvePath(e,o.imports[l]))&&p(r);if(o.weakImports)for(l=0;l<o.weakImports.length;++l)(r=u(o.weakImports[l])||i.resolvePath(e,o.weakImports[l]))&&p(r,!0)}else i.setOptions(t.options).addJSON(t.nested)}catch(e){c(e)}a||d||c(null,i)}function p(e,t){if(!(i.files.indexOf(e)>-1))if(i.files.push(e),e in o)a?l(e,o[e]):(++d,setTimeout((function(){--d,l(e,o[e])})));else if(a){var n;try{n=h.fs.readFileSync(e).toString("utf8")}catch(e){return void(t||c(e))}l(e,n)}else++d,h.fetch(e,(function(n,s){--d,r&&(n?t?d||c(null,i):c(n):l(e,s))}))}var d=0;h.isString(t)&&(t=[t]);for(var y,g=0;g<t.length;++g)(y=i.resolvePath("",t[g]))&&p(y);if(a)return i;d||c(null,i)},l.prototype.loadSync=function(e,t){if(!h.isNode)throw Error("not supported");return this.load(e,t,f)},l.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map((function(e){return"'extend "+e.extend+"' in "+e.parent.fullName})).join(", "));return r.prototype.resolveAll.call(this)};var p=/^[A-Z]/;function d(e,t){var n=t.parent.lookup(t.extend);if(n){var r=new a(t.fullName,t.id,t.type,t.rule,void 0,t.options);return r.declaringField=t,t.extensionField=r,n.add(r),!0}return!1}l.prototype._handleAdd=function(e){if(e instanceof a)void 0===e.extend||e.extensionField||d(0,e)||this.deferred.push(e);else if(e instanceof c)p.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof i)for(var t=0;t<this.deferred.length;)d(0,this.deferred[t])?this.deferred.splice(t,1):++t;for(var n=0;n<e.nestedArray.length;++n)this._handleAdd(e._nestedArray[n]);p.test(e.name)&&(e.parent[e.name]=e)}},l.prototype._handleRemove=function(e){if(e instanceof a){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof c)p.test(e.name)&&delete e.parent[e.name];else if(e instanceof r){for(var n=0;n<e.nestedArray.length;++n)this._handleRemove(e._nestedArray[n]);p.test(e.name)&&delete e.parent[e.name]}},l._configure=function(e,t,n){i=e,s=t,o=n}},function(e,t,n){"use strict";e.exports=n(39)},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";e.exports=function(e,t){var n=new Array(arguments.length-1),r=0,i=2,s=!0;for(;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,o){n[r]=function(e){if(s)if(s=!1,e)o(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){s&&(s=!1,o(e))}}))}},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,n){"use strict";t.Service=n(50)},function(e,t,n){"use strict";e.exports={}},function(e,t,n){"use strict";e.exports=function(e){for(var t,n=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),a=e.fieldsArray.slice().sort(s.compareFieldsById),c=0;c<a.length;++c){var u=a[c].resolve(),h=e._fieldsArray.indexOf(u),l=u.resolvedType instanceof r?"int32":u.type,f=i.basic[l];t="m"+s.safeProp(u.name),u.map?(n("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",t,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",t)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===f?n("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",h,t):n(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|f,l,t),n("}")("}")):u.repeated?(n("if(%s!=null&&%s.length){",t,t),u.packed&&void 0!==i.packed[l]?n("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",t)("w.%s(%s[i])",l,t)("w.ldelim()"):(n("for(var i=0;i<%s.length;++i)",t),void 0===f?o(n,u,h,t+"[i]"):n("w.uint32(%i).%s(%s[i])",(u.id<<3|f)>>>0,l,t)),n("}")):(u.optional&&n("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",t,u.name),void 0===f?o(n,u,h,t):n("w.uint32(%i).%s(%s)",(u.id<<3|f)>>>0,l,t))}return n("return w")};var r=n(2),i=n(6),s=n(1);function o(e,t,n,r){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,r,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,r,(t.id<<3|2)>>>0)}},function(e,t,n){"use strict";e.exports=function(e){var t=s.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter((function(e){return e.map})).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break");t("switch(t>>>3){");for(var n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),c=a.resolvedType instanceof r?"int32":a.type,u="m"+s.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",u)("%s={}",u)("k=r.%s()",a.keyType)("r.pos++"),void 0!==i.long[a.keyType]?void 0===i.basic[c]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',u,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',u,c):void 0===i.basic[c]?t("%s[k]=types[%i].decode(r,r.uint32())",u,n):t("%s[k]=r.%s()",u,c)):a.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[c]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,c)("}else"),void 0===i.basic[c]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,n):t("%s.push(r.%s())",u,c)):void 0===i.basic[c]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,n):t("%s=r.%s()",u,c),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var h=e._fieldsArray[n];h.required&&t("if(!m.hasOwnProperty(%j))",h.name)("throw util.ProtocolError(%j,{instance:m})",o(h))}return t("return m")};var r=n(2),i=n(6),s=n(1);function o(e){return"missing required '"+e.name+"'"}},function(e,t,n){"use strict";e.exports=function(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),n=e.oneofsArray,r={};n.length&&t("var p={}");for(var c=0;c<e.fieldsArray.length;++c){var u=e._fieldsArray[c].resolve(),h="m"+i.safeProp(u.name);if(u.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",h,u.name),u.map)t("if(!util.isObject(%s))",h)("return%j",s(u,"object"))("var k=Object.keys(%s)",h)("for(var i=0;i<k.length;++i){"),a(t,u,"k[i]"),o(t,u,c,h+"[k[i]]")("}");else if(u.repeated)t("if(!Array.isArray(%s))",h)("return%j",s(u,"array"))("for(var i=0;i<%s.length;++i){",h),o(t,u,c,h+"[i]")("}");else{if(u.partOf){var l=i.safeProp(u.partOf.name);1===r[u.partOf.name]&&t("if(p%s===1)",l)("return%j",u.partOf.name+": multiple values"),r[u.partOf.name]=1,t("p%s=1",l)}o(t,u,c,h)}u.optional&&t("}")}return t("return null")};var r=n(2),i=n(1);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function o(e,t,n,i){if(t.resolvedType)if(t.resolvedType instanceof r){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var o=Object.keys(t.resolvedType.values),a=0;a<o.length;++a)e("case %i:",t.resolvedType.values[o[a]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",n,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function a(e,t,n){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",n)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",n)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",n)("return%j",s(t,"boolean key"))}return e}},function(e,t,n){"use strict";var r=t,i=n(2),s=n(1);function o(e,t,n,r){if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",r);for(var s=t.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)t.repeated&&s[o[a]]===t.typeDefault&&e("default:"),e("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");e("}")}else e('if(typeof d%s!=="object")',r)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,n,r);else{var c=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",r,r);break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,c)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,c?"true":"");break;case"bytes":e('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length)",r)("m%s=d%s",r,r);break;case"string":e("m%s=String(d%s)",r,r);break;case"bool":e("m%s=Boolean(d%s)",r,r)}}return e}function a(e,t,n,r){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?types[%i].values[m%s]:m%s",r,n,r,r):e("d%s=types[%i].toObject(m%s,o)",r,n,r);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,s?"true":"",r);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:e("d%s=m%s",r,r)}}return e}r.fromObject=function(e){var t=e.fieldsArray,n=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return n("return new this.ctor");n("var m=new this.ctor");for(var r=0;r<t.length;++r){var a=t[r].resolve(),c=s.safeProp(a.name);a.map?(n("if(d%s){",c)('if(typeof d%s!=="object")',c)("throw TypeError(%j)",a.fullName+": object expected")("m%s={}",c)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",c),o(n,a,r,c+"[ks[i]]")("}")("}")):a.repeated?(n("if(d%s){",c)("if(!Array.isArray(d%s))",c)("throw TypeError(%j)",a.fullName+": array expected")("m%s=[]",c)("for(var i=0;i<d%s.length;++i){",c),o(n,a,r,c+"[i]")("}")("}")):(a.resolvedType instanceof i||n("if(d%s!=null){",c),o(n,a,r,c),a.resolvedType instanceof i||n("}"))}return n("return m")},r.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var n=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],o=[],c=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?r:t[u].map?o:c).push(t[u]);if(r.length){for(n("if(o.arrays||o.defaults){"),u=0;u<r.length;++u)n("d%s=[]",s.safeProp(r[u].name));n("}")}if(o.length){for(n("if(o.objects||o.defaults){"),u=0;u<o.length;++u)n("d%s={}",s.safeProp(o[u].name));n("}")}if(c.length){for(n("if(o.defaults){"),u=0;u<c.length;++u){var h=c[u],l=s.safeProp(h.name);if(h.resolvedType instanceof i)n("d%s=o.enums===String?%j:%j",l,h.resolvedType.valuesById[h.typeDefault],h.typeDefault);else if(h.long)n("if(util.Long){")("var n=new util.Long(%i,%i,%j)",h.typeDefault.low,h.typeDefault.high,h.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",l)("}else")("d%s=o.longs===String?%j:%i",l,h.typeDefault.toString(),h.typeDefault.toNumber());else if(h.bytes){var f="["+Array.prototype.slice.call(h.typeDefault).join(",")+"]";n("if(o.bytes===String)d%s=%j",l,String.fromCharCode.apply(String,h.typeDefault))("else{")("d%s=%s",l,f)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",l,l)("}")}else n("d%s=%j",l,h.typeDefault)}n("}")}var p=!1;for(u=0;u<t.length;++u){h=t[u];var d=e._fieldsArray.indexOf(h);l=s.safeProp(h.name);h.map?(p||(p=!0,n("var ks2")),n("if(m%s&&(ks2=Object.keys(m%s)).length){",l,l)("d%s={}",l)("for(var j=0;j<ks2.length;++j){"),a(n,h,d,l+"[ks2[j]]")("}")):h.repeated?(n("if(m%s&&m%s.length){",l,l)("d%s=[]",l)("for(var j=0;j<m%s.length;++j){",l),a(n,h,d,l+"[j]")("}")):(n("if(m%s!=null&&m.hasOwnProperty(%j)){",l,h.name),a(n,h,d,l),h.partOf&&n("if(o.oneofs)")("d%s=%j",s.safeProp(h.partOf.name),h.name)),n("}")}return n("return d")}},function(e,t,n){"use strict";var r=t,i=n(15);r[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=this.lookup(e["@type"]);if(t){var n="."===e["@type"].charAt(0)?e["@type"].substr(1):e["@type"];return this.create({type_url:"/"+n,value:t.encode(t.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){if(t&&t.json&&e.type_url&&e.value){var n=e.type_url.substring(e.type_url.lastIndexOf("/")+1),r=this.lookup(n);r&&(e=r.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var s=e.$type.toObject(e,t);return s["@type"]=e.$type.fullName,s}return this.toObject(e,t)}}},function(e,t,n){"use strict";e.exports=p;var r=/[\s{}=;:[\],'"()<>]/g,i=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,s=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,o=/^ *[*/]+ */,a=/^\s*\*?\/*/,c=/\n/g,u=/\s/,h=/\\(.?)/g,l={0:"\0",r:"\r",n:"\n",t:"\t"};function f(e){return e.replace(h,(function(e,t){switch(t){case"\\":case"":return t;default:return l[t]||""}}))}function p(e,t){e=e.toString();var n=0,h=e.length,l=1,p=null,d=null,y=0,g=!1,v=[],m=null;function w(e){return Error("illegal "+e+" (line "+l+")")}function b(t){return e.charAt(t)}function A(n,r){p=e.charAt(n++),y=l,g=!1;var i,s=n-(t?2:3);do{if(--s<0||"\n"===(i=e.charAt(s))){g=!0;break}}while(" "===i||"\t"===i);for(var u=e.substring(n,r).split(c),h=0;h<u.length;++h)u[h]=u[h].replace(t?a:o,"").trim();d=u.join("\n").trim()}function S(t){var n=O(t),r=e.substring(t,n);return/^\s*\/{1,2}/.test(r)}function O(e){for(var t=e;t<h&&"\n"!==b(t);)t++;return t}function k(){if(v.length>0)return v.shift();if(m)return function(){var t="'"===m?s:i;t.lastIndex=n-1;var r=t.exec(e);if(!r)throw w("string");return n=t.lastIndex,E(m),m=null,f(r[1])}();var o,a,c,p,d;do{if(n===h)return null;for(o=!1;u.test(c=b(n));)if("\n"===c&&++l,++n===h)return null;if("/"===b(n)){if(++n===h)throw w("comment");if("/"===b(n))if(t){if(p=n,d=!1,S(n)){d=!0;do{if((n=O(n))===h)break;n++}while(S(n))}else n=Math.min(h,O(n)+1);d&&A(p,n),l++,o=!0}else{for(d="/"===b(p=n+1);"\n"!==b(++n);)if(n===h)return null;++n,d&&A(p,n-1),++l,o=!0}else{if("*"!==(c=b(n)))return"/";p=n+1,d=t||"*"===b(p);do{if("\n"===c&&++l,++n===h)throw w("comment");a=c,c=b(n)}while("*"!==a||"/"!==c);++n,d&&A(p,n-2),o=!0}}}while(o);var y=n;if(r.lastIndex=0,!r.test(b(y++)))for(;y<h&&!r.test(b(y));)++y;var g=e.substring(n,n=y);return'"'!==g&&"'"!==g||(m=g),g}function E(e){v.push(e)}function C(){if(!v.length){var e=k();if(null===e)return null;E(e)}return v[0]}return Object.defineProperty({next:k,peek:C,push:E,skip:function(e,t){var n=C();if(n===e)return k(),!0;if(!t)throw w("token '"+n+"', '"+e+"' expected");return!1},cmnt:function(e){var n=null;return void 0===e?y===l-1&&(t||"*"===p||g)&&(n=d):(y<e&&C(),y!==e||g||!t&&"/"!==p||(n=d)),n}},"line",{get:function(){return l}})}p.unescape=f},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,s=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var i,s,o,a;if(u(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"==typeof o?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=h(e))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,console&&console.warn&&console.warn(a)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=f.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length)}function y(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var u=c.length,h=g(c,u);for(n=0;n<u;++n)s(h[n],this,t)}return!0},a.prototype.addListener=function(e,t){return l(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return l(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,s,o;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){return d(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):y.call(e,t)},a.prototype.listenerCount=y,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t){e.exports="<div> <h1> Welcome to greenchat! </h1> <p>Your device is being prepared, please hold on.</p> </div>"},function(e,t){e.exports="<h1>Greenchat Home</h1> <nav> <a href=link-device>Link Device</a> <a href=open-source-info>Open Source</a> </nav> <h2>List of your notes</h2> <ol id=notes-list> </ol> <div> <p>Add a note</p> <div> <input type=text id=note-content /> </div> <div> <button type=button id=addNoteBtn>Add Note</button> </div> </div> <div>This is an experimental app</div>"},function(e,t){e.exports="<h1>Link another of your devices to this account</h1> "},function(e,t){e.exports="<div id=process-start-pane> <p>On the first device generate device invite code: <button type=button id=generate>Start</button></p> <p> On the second device paste the invite code: </p><div> <input type=text id=pasted-code /> <button id=redeem-code>redeem code</button> </div> <p></p> </div> <div id=invite-code-pane> Invite-Code: <span id=inv-code></span> </div>"},function(e,t){e.exports="<h1>Greenchat Open Source</h1> <p> The source code is available at <a href=https://github.com/tuwrraphael/greenchat>Github</a> </p> <h2>Third Party Components</h2> <p> The following third party components are used: </p><div id=third-party></div> <p></p>"},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(36),i=n(37),s=n(38);function o(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=f(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(t,n),i=(e=a(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|p(t.length);return 0===(e=a(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):f(e,t);if("Buffer"===t.type&&s(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function h(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(h(t),e=a(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|p(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function d(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return J(e).length;default:if(r)return U(e).length;t=(""+t).toLowerCase(),r=!0}}function y(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return C(this,t,n);case"ascii":return L(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,i){var s,o=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var h=-1;for(s=n;s<a;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===c)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){for(var l=!0,f=0;f<c;f++)if(u(e,s+f)!==u(t,f)){l=!1;break}if(l)return s}return-1}function w(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[n+o]=a}return o}function b(e,t,n,r){return q(U(t,e.length-n),e,n,r)}function A(e,t,n,r){return q(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return A(e,t,n,r)}function O(e,t,n,r){return q(J(t),e,n,r)}function k(e,t,n,r){return q(function(e,t){for(var n,r,i,s=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}(t,e.length-n),e,n,r)}function E(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function C(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,o,a,c,u=e[i],h=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l<=n)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(s=e[i+1]))&&(c=(31&u)<<6|63&s)>127&&(h=c);break;case 3:s=e[i+1],o=e[i+2],128==(192&s)&&128==(192&o)&&(c=(15&u)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:s=e[i+1],o=e[i+2],a=e[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=l}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return h(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return l(null,e)},c.allocUnsafeSlow=function(e){return l(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},c.byteLength=d,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?C(this,0,e):y.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),a=Math.min(s,o),u=this.slice(r,i),h=e.slice(t,n),l=0;l<a;++l)if(u[l]!==h[l]){s=u[l],o=h[l];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return w(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return A(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return O(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function L(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function x(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=M(e[s]);return i}function _(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function T(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function K(e,t,n,r,i,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function j(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-n,2);i<s;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function P(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-n,4);i<s;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function R(e,t,n,r,i,s){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(e,t,n,r,s){return s||R(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function D(e,t,n,r,s){return s||R(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var s=0;s<i;++s)n[s]=this[s+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||T(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||T(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||T(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||T(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||T(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||T(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||T(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||T(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||T(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return t||T(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||T(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||T(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||T(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||T(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||T(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||T(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||T(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||T(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||K(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||K(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||K(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||K(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):j(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||K(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):j(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||K(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):P(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||K(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);K(this,e,t,n,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);K(this,e,t,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||K(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||K(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):j(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||K(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):j(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||K(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||K(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return B(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return B(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return D(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return D(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,s=r-n;if(this===e&&n<t&&t<r)for(i=s-1;i>=0;--i)e[i+t]=this[i+n];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var o=c.isBuffer(e)?e:U(new c(e,r).toString()),a=o.length;for(s=0;s<n-t;++s)this[s+t]=o[s%a]}return this};var N=/[^+\/0-9A-Za-z-_]/g;function M(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var n;t=t||1/0;for(var r=e.length,i=null,s=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function J(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(N,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(18))},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),o=r[0],a=r[1],c=new s(function(e,t,n){return 3*(t+n)/4-n}(0,o,a)),h=0,l=a>0?o-4:o;for(n=0;n<l;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[h++]=t>>16&255,c[h++]=t>>8&255,c[h++]=255&t;2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[h++]=255&t);1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[h++]=t>>8&255,c[h++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],o=0,a=n-i;o<a;o+=16383)s.push(h(e,o,o+16383>a?a:o+16383));1===i?(t=e[n-1],s.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],s.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return s.join("")};for(var r=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)r[a]=o[a],i[o.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function h(e,t,n){for(var i,s,o=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(r[(s=i)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var s,o,a=8*i-r-1,c=(1<<a)-1,u=c>>1,h=-7,l=n?i-1:0,f=n?-1:1,p=e[t+l];for(l+=f,s=p&(1<<-h)-1,p>>=-h,h+=a;h>0;s=256*s+e[t+l],l+=f,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=r;h>0;o=256*o+e[t+l],l+=f,h-=8);if(0===s)s=1-u;else{if(s===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),s-=u}return(p?-1:1)*o*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var o,a,c,u=8*s-i-1,h=(1<<u)-1,l=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,d=r?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+l>=1?f/c:f*Math.pow(2,1-l))*c>=2&&(o++,c/=2),o+l>=h?(a=0,o=h):o+l>=1?(a=(t*c-1)*Math.pow(2,i),o+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),o=0));i>=8;e[n+p]=255&a,p+=d,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[n+p]=255&o,p+=d,o/=256,u-=8);e[n+p-d]|=128*y}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var r=e.exports=n(40);r.build="full",r.tokenize=n(28),r.parse=n(54),r.common=n(55),r.Root._configure(r.Type,r.parse,r.common)},function(e,t,n){"use strict";var r=e.exports=n(41);r.build="light",r.load=function(e,t,n){return"function"==typeof t?(n=t,t=new r.Root):t||(t=new r.Root),t.load(e,n)},r.loadSync=function(e,t){return t||(t=new r.Root),t.loadSync(e)},r.encoder=n(23),r.decoder=n(24),r.verifier=n(25),r.converter=n(26),r.ReflectionObject=n(5),r.Namespace=n(7),r.Root=n(16),r.Enum=n(2),r.Type=n(11),r.Field=n(4),r.OneOf=n(8),r.MapField=n(12),r.Service=n(13),r.Method=n(14),r.Message=n(15),r.wrappers=n(27),r.types=n(6),r.util=n(1),r.ReflectionObject._configure(r.Root),r.Namespace._configure(r.Type,r.Service,r.Enum),r.Root._configure(r.Type),r.Field._configure(r.Type)},function(e,t,n){"use strict";var r=t;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(9),r.BufferWriter=n(48),r.Reader=n(10),r.BufferReader=n(49),r.util=n(3),r.rpc=n(21),r.roots=n(22),r.configure=i,i()},function(e,t,n){"use strict";var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var i=new Array(64),s=new Array(123),o=0;o<64;)s[i[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;r.encode=function(e,t,n){for(var r,s=null,o=[],a=0,c=0;t<n;){var u=e[t++];switch(c){case 0:o[a++]=i[u>>2],r=(3&u)<<4,c=1;break;case 1:o[a++]=i[r|u>>4],r=(15&u)<<2,c=2;break;case 2:o[a++]=i[r|u>>6],o[a++]=i[63&u],c=0}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return c&&(o[a++]=i[r],o[a++]=61,1===c&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};r.decode=function(e,t,n){for(var r,i=n,o=0,a=0;a<e.length;){var c=e.charCodeAt(a++);if(61===c&&o>1)break;if(void 0===(c=s[c]))throw Error("invalid encoding");switch(o){case 0:r=c,o=1;break;case 1:t[n++]=r<<2|(48&c)>>4,r=c,o=2;break;case 2:t[n++]=(15&r)<<4|(60&c)>>2,r=c,o=3;break;case 3:t[n++]=(3&r)<<6|c,o=0}}if(1===o)throw Error("invalid encoding");return n-i},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,n){"use strict";function r(){this._listeners={}}e.exports=r,r.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},r.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},r.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},function(e,t,n){"use strict";function r(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function s(e,r,i){t[0]=e,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function o(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function a(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?i:s,e.writeFloatBE=r?s:i,e.readFloatLE=r?o:a,e.readFloatBE=r?a:o}():function(){function t(e,t,n,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var s=Math.floor(Math.log(t)/Math.LN2);e((i<<31|s+127<<23|8388607&Math.round(t*Math.pow(2,-s)*8388608))>>>0,n,r)}}function n(e,t,n){var r=e(t,n),i=2*(r>>31)+1,s=r>>>23&255,o=8388607&r;return 255===s?o?NaN:i*(1/0):0===s?1401298464324817e-60*i*o:i*Math.pow(2,s-150)*(o+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,s),e.readFloatLE=n.bind(null,o),e.readFloatBE=n.bind(null,a)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function s(e,r,i){t[0]=e,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function o(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function a(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:s,e.writeDoubleBE=r?s:i,e.readDoubleLE=r?o:a,e.readDoubleBE=r?a:o}():function(){function t(e,t,n,r,i,s){var o=r<0?1:0;if(o&&(r=-r),0===r)e(0,i,s+t),e(1/r>0?0:2147483648,i,s+n);else if(isNaN(r))e(0,i,s+t),e(2146959360,i,s+n);else if(r>17976931348623157e292)e(0,i,s+t),e((o<<31|2146435072)>>>0,i,s+n);else{var a;if(r<22250738585072014e-324)e((a=r/5e-324)>>>0,i,s+t),e((o<<31|a/4294967296)>>>0,i,s+n);else{var c=Math.floor(Math.log(r)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(a=r*Math.pow(2,-c))>>>0,i,s+t),e((o<<31|c+1023<<20|1048576*a&1048575)>>>0,i,s+n)}}}function n(e,t,n,r,i){var s=e(r,i+t),o=e(r,i+n),a=2*(o>>31)+1,c=o>>>20&2047,u=4294967296*(1048575&o)+s;return 2047===c?u?NaN:a*(1/0):0===c?5e-324*a*u:a*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,s,4,0),e.readDoubleLE=n.bind(null,o,0,4),e.readDoubleBE=n.bind(null,a,4,0)}(),e}function i(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function s(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=r(r)},function(e,t,n){"use strict";var r=t;r.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},r.read=function(e,t,n){if(n-t<1)return"";for(var r,i=null,s=[],o=0;t<n;)(r=e[t++])<128?s[o++]=r:r>191&&r<224?s[o++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(r>>10),s[o++]=56320+(1023&r)):s[o++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0);return i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))},r.write=function(e,t,n){for(var r,i,s=n,o=0;o<e.length;++o)(r=e.charCodeAt(o))<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(o+1)))?(r=65536+((1023&r)<<10)+(1023&i),++o,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-s}},function(e,t,n){"use strict";e.exports=function(e,t,n){var r=n||8192,i=r>>>1,s=null,o=r;return function(n){if(n<1||n>i)return e(n);o+n>r&&(s=e(r),o=0);var a=t.call(s,o,o+=n);return 7&o&&(o=1+(7|o)),a}}},function(e,t,n){"use strict";e.exports=i;var r=n(3);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new i(n,r)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(r.isString(e)){if(!r.Long)return i.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return e===o?s:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},function(e,t,n){"use strict";e.exports=s;var r=n(9);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(3);function s(){r.call(this)}function o(e,t,n){e.length<40?i.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},s._configure()},function(e,t,n){"use strict";e.exports=s;var r=n(10);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(3);function s(e){r.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},function(e,t,n){"use strict";e.exports=i;var r=n(3);function i(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,n,i,s,o){if(!s)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(e,a,t,n,i,s);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](s).finish(),(function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof i))try{n=i[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,n){"use strict";function r(e,t){"string"==typeof e&&(t=e,e=void 0);var n=[];function i(e){if("string"!=typeof e){var t=s();if(r.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var o=Object.keys(e),a=new Array(o.length+1),c=new Array(o.length),u=0;u<o.length;)a[u]=o[u],c[u]=e[o[u++]];return a[u]=t,Function.apply(null,a).apply(null,c)}return Function(t)()}for(var h=new Array(arguments.length-1),l=0;l<h.length;)h[l]=arguments[++l];if(l=0,e=e.replace(/%([%dfijs])/g,(function(e,t){var n=h[l++];switch(t){case"d":case"f":return String(Number(n));case"i":return String(Math.floor(n));case"j":return JSON.stringify(n);case"s":return String(n)}return"%"})),l!==h.length)throw Error("parameter count mismatch");return n.push(e),i}function s(r){return"function "+(r||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+n.join("\n  ")+"\n}"}return i.toString=s,i}e.exports=r,r.verbose=!1},function(e,t,n){"use strict";e.exports=s;var r=n(19),i=n(20)("fs");function s(e,t,n){return"function"==typeof t?(n=t,t={}):t||(t={}),n?!t.xhr&&i&&i.readFile?i.readFile(e,(function(r,i){return r&&"undefined"!=typeof XMLHttpRequest?s.xhr(e,t,n):r?n(r):n(null,t.binary?i:i.toString("utf8"))})):s.xhr(e,t,n):r(s,this,e,t)}s.xhr=function(e,t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState){if(0!==r.status&&200!==r.status)return n(Error("status "+r.status));if(t.binary){var e=r.response;if(!e){e=[];for(var i=0;i<r.responseText.length;++i)e.push(255&r.responseText.charCodeAt(i))}return n(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return n(null,r.responseText)}},t.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",e),r.send()}},function(e,t,n){"use strict";var r=t,i=r.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},s=r.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),n=i(e),r="";n&&(r=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):n?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return r+t.join("/")};r.resolve=function(e,t,n){return n||(t=s(t)),i(t)?t:(n||(e=s(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?s(e+"/"+t):t)}},function(e,t,n){"use strict";e.exports=k,k.filename=null,k.defaults={keepCase:!1};var r=n(28),i=n(16),s=n(11),o=n(4),a=n(12),c=n(8),u=n(2),h=n(13),l=n(14),f=n(6),p=n(1),d=/^[1-9][0-9]*$/,y=/^-?[1-9][0-9]*$/,g=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,m=/^0[0-7]+$/,w=/^-?0[0-7]+$/,b=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,A=/^[a-zA-Z_][a-zA-Z_0-9]*$/,S=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,O=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function k(e,t,n){t instanceof i||(n=t,t=new i),n||(n=k.defaults);var E,C,L,I,x,_=r(e,n.alternateCommentMode||!1),T=_.next,K=_.push,j=_.peek,P=_.skip,R=_.cmnt,B=!0,D=!1,N=t,M=n.keepCase?function(e){return e}:p.camelCase;function U(e,t,n){var r=k.filename;return n||(k.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(r?r+", ":"")+"line "+_.line+")")}function J(){var e,t=[];do{if('"'!==(e=T())&&"'"!==e)throw U(e);t.push(T()),P(e),e=j()}while('"'===e||"'"===e);return t.join("")}function q(e){var t=T();switch(t){case"'":case'"':return K(t),J();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return function(e,t){var n=1;"-"===e.charAt(0)&&(n=-1,e=e.substring(1));switch(e){case"inf":case"INF":case"Inf":return n*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(d.test(e))return n*parseInt(e,10);if(g.test(e))return n*parseInt(e,16);if(m.test(e))return n*parseInt(e,8);if(b.test(e))return n*parseFloat(e);throw U(e,"number",t)}(t,!0)}catch(n){if(e&&S.test(t))return t;throw U(t,"value")}}function F(e,t){var n,r;do{!t||'"'!==(n=j())&&"'"!==n?e.push([r=H(T()),P("to",!0)?H(T()):r]):e.push(J())}while(P(",",!0));P(";")}function H(e,t){switch(e){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!t&&"-"===e.charAt(0))throw U(e,"id");if(y.test(e))return parseInt(e,10);if(v.test(e))return parseInt(e,16);if(w.test(e))return parseInt(e,8);throw U(e,"id")}function z(){if(void 0!==E)throw U("package");if(E=T(),!S.test(E))throw U(E,"name");N=N.define(E),P(";")}function $(){var e,t=j();switch(t){case"weak":e=L||(L=[]),T();break;case"public":T();default:e=C||(C=[])}t=J(),P(";"),e.push(t)}function V(){if(P("="),I=J(),!(D="proto3"===I)&&"proto2"!==I)throw U(I,"syntax");P(";")}function Y(e,t){switch(t){case"option":return Z(e,t),P(";"),!0;case"message":return function(e,t){if(!A.test(t=T()))throw U(t,"type name");var n=new s(t);W(n,(function(e){if(!Y(n,e))switch(e){case"map":!function(e){P("<");var t=T();if(void 0===f.mapKey[t])throw U(t,"type");P(",");var n=T();if(!S.test(n))throw U(n,"type");P(">");var r=T();if(!A.test(r))throw U(r,"name");P("=");var i=new a(M(r),H(T()),t,n);W(i,(function(e){if("option"!==e)throw U(e);Z(i,e),P(";")}),(function(){ee(i)})),e.add(i)}(n);break;case"required":case"optional":case"repeated":G(n,e);break;case"oneof":!function(e,t){if(!A.test(t=T()))throw U(t,"name");var n=new c(M(t));W(n,(function(e){"option"===e?(Z(n,e),P(";")):(K(e),G(n,"optional"))})),e.add(n)}(n,e);break;case"extensions":F(n.extensions||(n.extensions=[]));break;case"reserved":F(n.reserved||(n.reserved=[]),!0);break;default:if(!D||!S.test(e))throw U(e);K(e),G(n,"optional")}})),e.add(n)}(e,t),!0;case"enum":return function(e,t){if(!A.test(t=T()))throw U(t,"name");var n=new u(t);W(n,(function(e){switch(e){case"option":Z(n,e),P(";");break;case"reserved":F(n.reserved||(n.reserved=[]),!0);break;default:!function(e,t){if(!A.test(t))throw U(t,"name");P("=");var n=H(T(),!0),r={};W(r,(function(e){if("option"!==e)throw U(e);Z(r,e),P(";")}),(function(){ee(r)})),e.add(t,n,r.comment)}(n,e)}})),e.add(n)}(e,t),!0;case"service":return function(e,t){if(!A.test(t=T()))throw U(t,"service name");var n=new h(t);W(n,(function(e){if(!Y(n,e)){if("rpc"!==e)throw U(e);!function(e,t){var n=R(),r=t;if(!A.test(t=T()))throw U(t,"name");var i,s,o,a,c=t;P("("),P("stream",!0)&&(s=!0);if(!S.test(t=T()))throw U(t);i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(a=!0);if(!S.test(t=T()))throw U(t);o=t,P(")");var u=new l(c,r,i,o,s,a);u.comment=n,W(u,(function(e){if("option"!==e)throw U(e);Z(u,e),P(";")})),e.add(u)}(n,e)}})),e.add(n)}(e,t),!0;case"extend":return function(e,t){if(!S.test(t=T()))throw U(t,"reference");var n=t;W(null,(function(t){switch(t){case"required":case"repeated":case"optional":G(e,t,n);break;default:if(!D||!S.test(t))throw U(t);K(t),G(e,"optional",n)}}))}(e,t),!0}return!1}function W(e,t,n){var r=_.line;if(e&&("string"!=typeof e.comment&&(e.comment=R()),e.filename=k.filename),P("{",!0)){for(var i;"}"!==(i=T());)t(i);P(";",!0)}else n&&n(),P(";"),e&&"string"!=typeof e.comment&&(e.comment=R(r))}function G(e,t,n){var r=T();if("group"!==r){if(!S.test(r))throw U(r,"type");var i=T();if(!A.test(i))throw U(i,"name");i=M(i),P("=");var a=new o(i,H(T()),r,t,n);W(a,(function(e){if("option"!==e)throw U(e);Z(a,e),P(";")}),(function(){ee(a)})),e.add(a),D||!a.repeated||void 0===f.packed[r]&&void 0!==f.basic[r]||a.setOption("packed",!1,!0)}else!function(e,t){var n=T();if(!A.test(n))throw U(n,"name");var r=p.lcFirst(n);n===r&&(n=p.ucFirst(n));P("=");var i=H(T()),a=new s(n);a.group=!0;var c=new o(r,i,n,t);c.filename=k.filename,W(a,(function(e){switch(e){case"option":Z(a,e),P(";");break;case"required":case"optional":case"repeated":G(a,e);break;default:throw U(e)}})),e.add(a).add(c)}(e,t)}function Z(e,t){var n=P("(",!0);if(!S.test(t=T()))throw U(t,"name");var r=t;n&&(P(")"),r="("+r+")",t=j(),O.test(t)&&(r+=t,T())),P("="),X(e,r)}function X(e,t){if(P("{",!0))do{if(!A.test(x=T()))throw U(x,"name");"{"===j()?X(e,t+"."+x):(P(":"),"{"===j()?X(e,t+"."+x):Q(e,t+"."+x,q(!0))),P(",",!0)}while(!P("}",!0));else Q(e,t,q(!0))}function Q(e,t,n){e.setOption&&e.setOption(t,n)}function ee(e){if(P("[",!0)){do{Z(e,"option")}while(P(",",!0));P("]")}return e}for(;null!==(x=T());)switch(x){case"package":if(!B)throw U(x);z();break;case"import":if(!B)throw U(x);$();break;case"syntax":if(!B)throw U(x);V();break;case"option":Z(N,x),P(";");break;default:if(Y(N,x)){B=!1;continue}throw U(x)}return k.filename=null,{package:E,imports:C,weakImports:L,syntax:I,root:t}}},function(e,t,n){"use strict";e.exports=s;var r,i=/\/|\./;function s(e,t){i.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),s[e]=t}s("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),s("duration",{Duration:r={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),s("timestamp",{Timestamp:r}),s("empty",{Empty:{fields:{}}}),s("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),s("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),s("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),s.get=function(e){return s[e]||null}},function(e,t,n){"use strict";n.r(t);class r{constructor(e,t){this.routeResolver=e,this.routeRenderer=t,this.lastRoute=null,this.popStateListener=this.handlePopState.bind(this)}handlePopState(e){this.doRouting(window.location.pathname)}run(){let e=document.querySelector("base");this.basePrefix=e.getAttribute("href"),this.baseHref=e.href,window.addEventListener("popstate",this.popStateListener),this.doRouting(window.location.pathname)}destroy(){window.removeEventListener("popstate",this.popStateListener)}doRouting(e){let t=this.getRoute(e),n=this.routeResolver.resolve(this.lastRoute,t,this);return!!n&&(this.routeRenderer.render(n),this.lastRoute=t,!0)}getRoute(e){let t=e===this.baseHref,n=e.substr(0,this.basePrefix.length)===this.basePrefix;return t?"/":n?e.substring(this.basePrefix.length):e}navigate(e,t){let n=new URL(e,this.baseHref);this.doRouting(n.pathname)&&window.history.pushState({},t||document.title,n.href)}}class i{constructor(){this.currentComponent=null}render(e){e&&(this.currentComponent&&document.body.removeChild(this.currentComponent),document.body.appendChild(e),this.currentComponent=e)}}const s=(e,t)=>t.some(t=>e instanceof t);let o,a;const c=new WeakMap,u=new WeakMap,h=new WeakMap,l=new WeakMap,f=new WeakMap;let p={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return u.get(e);if("objectStoreNames"===t)return e.objectStoreNames||h.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return v(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){p=e(p)}function y(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(m(this),t),v(c.get(this))}:function(...t){return v(e.apply(m(this),t))}:function(t,...n){const r=e.call(m(this),t,...n);return h.set(r,t.sort?t.sort():[t]),v(r)}}function g(e){return"function"==typeof e?y(e):(e instanceof IDBTransaction&&function(e){if(u.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});u.set(e,t)}(e),s(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,p):e)}function v(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(v(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&c.set(t,e)}).catch(()=>{}),f.set(t,e),t}(e);if(l.has(e))return l.get(e);const t=g(e);return t!==e&&(l.set(e,t),f.set(t,e)),t}const m=e=>f.get(e);const w=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],A=new Map;function S(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(A.get(t))return A.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=b.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!w.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;r&&(o=o.index(t.shift()));const a=o[n](...t);return i&&await s.done,a};return A.set(t,s),s}d(e=>({...e,get:(t,n,r)=>S(t,n)||e.get(t,n,r),has:(t,n)=>!!S(t,n)||e.has(t,n)}));const O=["continue","continuePrimaryKey","advance"],k={},E=new WeakMap,C=new WeakMap,L={get(e,t){if(!O.includes(t))return e[t];let n=k[t];return n||(n=k[t]=function(...e){E.set(this,C.get(this)[t](...e))}),n}};async function*I(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,L);for(C.set(n,t),f.set(n,m(t));t;)yield n,t=await(E.get(n)||t.continue()),E.delete(n)}function x(e,t){return t===Symbol.asyncIterator&&s(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&s(e,[IDBIndex,IDBObjectStore])}d(e=>({...e,get:(t,n,r)=>x(t,n)?I:e.get(t,n,r),has:(t,n)=>x(t,n)||e.has(t,n)}));class _{constructor(e,t,n,r,i,s){this.content=e,this.hash=t,this.previous=n,this.signature=r,this.timestamp=i,this.sequence=s}}class T{}var K=n(0);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function j(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}var P=n(17);class R{static async set(e){return new Uint8Array(e)}static async get(e){return new Uint8Array(e).buffer}}function B(e){return t=>{const n=t;n.localName=e.name||n.name||n.toString().match(/^function\s*([^\s(]+)/)[1],n.items=n.items||{},n.target=t,n.items=Object(K.b)({},n.items);const r=new P.Type(n.localName);for(const e in n.items){const t=n.items[e];let i=void 0;t.repeated?i="repeated":t.required&&(i="required"),r.add(new P.Field(t.name,t.id,t.type,i))}n.protobuf=r}}function D(e){return(t,n)=>{const r=t.constructor,i=n;r.items=r.items||{},r.target!==r&&(r.items=Object(K.b)({},r.items),r.target=r),r.items[i]={id:e.id,type:e.type||"bytes",defaultValue:e.defaultValue,converter:e.converter||null,parser:e.parser||null},e.name=e.name||i,r.items[i].name=e.name,r.items[i].required=e.required||!1,r.items[i].repeated=e.repeated||!1,function(e,t,n){const r="_"+t,i={set:function(e){this[r]!==e&&(this.raw=null,this[r]=e)},get:function(){if(void 0===this[r]){let e=n.defaultValue;n.parser&&!n.repeated&&(e=new n.parser),this[r]=e}return this[r]},enumerable:!0};Object.defineProperty(e,r,{writable:!0,enumerable:!1}),Object.defineProperty(e,t,i)}(t,i,r.items[i])}}class N{static async importProto(e){const t=new this;return await t.importProto(e),t}isEmpty(){return void 0===this.raw}hasChanged(){if(null===this.raw)return!0;const e=this.constructor,t=this;for(const n in e.items){const r=e.items[n];if(r.repeated){if(r.parser)return t[n].some(e=>e.hasChanged())}else if(r.parser&&t[n]&&t[n].hasChanged())return!0}return!1}async importProto(e){const t=this.constructor,n=this;let r,i;i=e instanceof N?await e.exportProto():e;try{r=t.protobuf.decode(new Uint8Array(i))}catch(e){throw new Error(`Error: Cannot decode message for ${t.localName}.\n$ProtobufError: ${e.message}`)}for(const e in t.items){const i=t.items[e];let s=r[i.name];ArrayBuffer.isView(s)&&(s=new Uint8Array(s)),Array.isArray(s)||(i.repeated?n[e]=s=[]:s=[s]),i.repeated&&!n[e]&&(n[e]=[]);for(const t of s)i.repeated?n[e].push(await this.importItem(i,t)):n[e]=await this.importItem(i,t)}this.raw=i}async exportProto(){if(!this.hasChanged())return this.raw;const e=this.constructor,t=this,n={};for(const r in e.items){const i=e.items[r];let s=t[r];Array.isArray(s)||(s=void 0===s?[]:[s]);for(const e of s){const t=await this.exportItem(i,e);i.repeated?(n[i.name]||(n[i.name]=[]),n[i.name].push(t)):n[i.name]=t}}return this.raw=new Uint8Array(e.protobuf.encode(n).finish()).buffer,this.raw}async exportItem(e,t){const n=this.constructor;let r;if(e.parser){const i=t,s=await i.exportProto();if(e.required&&!s)throw new Error(`Error: Paramter '${e.name}' is required in '${n.localName}' protobuf message.`);s&&(r=new Uint8Array(s))}else{if(e.required&&void 0===t)throw new Error(`Error: Paramter '${e.name}' is required in '${n.localName}' protobuf message.`);e.converter?t&&(r=await e.converter.set(t)):(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),r=t)}return r}async importItem(e,t){const n=this.constructor;let r;if(e.parser){const i=e.parser;if(t&&t.byteLength)r=await i.importProto(new Uint8Array(t).buffer);else if(e.required)throw new Error(`Error: Parameter '${e.name}' is required in '${n.localName}' protobuf message.`)}else if(e.converter){if(t&&t.byteLength)r=await e.converter.get(t);else if(e.required)throw new Error(`Error: Parameter '${e.name}' is required in '${n.localName}' protobuf message.`)}else r=t;return r}}var M=n(29);const U=K.a.FromBinary("InfoText"),J=K.a.FromBinary("InfoRatchet"),q=K.a.FromBinary("InfoMessageKeys");let F=null;function H(){if(!F)throw new Error("WebCrypto engine is empty. Use setEngine to resolve it.");return F}"undefined"!=typeof self&&(F={crypto:self.crypto,name:"WebCrypto"});class z{static async generateKeyPair(e){const t=e,n="ECDSA"===e?["sign","verify"]:["deriveKey","deriveBits"],r=await H().crypto.subtle.generateKey({name:t,namedCurve:this.NAMED_CURVE},!1,n),i=await Y.create(r.publicKey);return{privateKey:r.privateKey,publicKey:i}}static deriveBytes(e,t){return H().crypto.subtle.deriveBits({name:"ECDH",public:t.key},e,256)}static verify(e,t,n){return H().crypto.subtle.verify({name:"ECDSA",hash:this.DIGEST_ALGORITHM},e.key,n,t)}static async sign(e,t){return H().crypto.subtle.sign({name:"ECDSA",hash:this.DIGEST_ALGORITHM},e,t)}static async ecKeyPairToJson(e){return{privateKey:e.privateKey,publicKey:e.publicKey.key,thumbprint:await e.publicKey.thumbprint()}}static async ecKeyPairFromJson(e){return{privateKey:e.privateKey,publicKey:await Y.create(e.publicKey)}}}z.NAMED_CURVE="P-256",z.DIGEST_ALGORITHM="SHA-512";const $={name:"AES-CBC",length:256};class V{static randomBytes(e){const t=new Uint8Array(e);return H().crypto.getRandomValues(t),t.buffer}static digest(e,t){return H().crypto.subtle.digest(e,t)}static encrypt(e,t,n){return H().crypto.subtle.encrypt({name:"AES-CBC",iv:new Uint8Array(n)},e,t)}static decrypt(e,t,n){return H().crypto.subtle.decrypt({name:"AES-CBC",iv:new Uint8Array(n)},e,t)}static importHMAC(e){return H().crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"])}static importAES(e){return H().crypto.subtle.importKey("raw",e,$,!1,["encrypt","decrypt"])}static async sign(e,t){return await H().crypto.subtle.sign({name:"HMAC",hash:"SHA-256"},e,t)}static async HKDF(e,t=1,n,r=new ArrayBuffer(0)){n||(n=await this.importHMAC(new Uint8Array(32).buffer));const i=await this.sign(n,e),s=(new ArrayBuffer(32+r.byteLength+1),await this.importHMAC(i)),o=[new ArrayBuffer(0)];for(let e=0;e<t;e++)o[e+1]=await this.sign(s,Object(K.c)(o[e],r,new Uint8Array([e+1]).buffer));return o.slice(1)}}class Y{static async create(e){const t=new this,n=e.algorithm.name.toUpperCase();if("ECDH"!==n&&"ECDSA"!==n)throw new Error("Error: Unsupported asymmetric key algorithm.");if("public"!==e.type)throw new Error("Error: Expected key type to be public but it was not.");t.key=e;const r=await H().crypto.subtle.exportKey("jwk",e);if(!r.x||!r.y)throw new Error("Wrong JWK data for EC public key. Parameters x and y are required.");const i=K.a.FromBase64Url(r.x),s=K.a.FromBase64Url(r.y),o=K.a.ToBinary(i)+K.a.ToBinary(s);return t.serialized=K.a.FromBinary(o),t.id=await t.thumbprint(),t}static async importKey(e,t){const n=K.a.ToBase64Url(e.slice(0,32)),r=K.a.ToBase64Url(e.slice(32)),i={crv:z.NAMED_CURVE,kty:"EC",x:n,y:r},s="ECDSA"===t?["verify"]:[],o=await H().crypto.subtle.importKey("jwk",i,{name:t,namedCurve:z.NAMED_CURVE},!0,s);return await Y.create(o)}serialize(){return this.serialized}async thumbprint(){const e=await this.serialize(),t=await V.digest("SHA-256",e);return K.a.ToHex(t)}async isEqual(e){return!!(e&&e instanceof Y)&&Object(K.d)(this.serialized,e.serialized)}}class W{constructor(e,t,n){this.id=e,this.signingKey=t,this.exchangeKey=n,this.preKeys=[],this.signedPreKeys=[]}static async fromJSON(e){const t=await z.ecKeyPairFromJson(e.signingKey),n=await z.ecKeyPairFromJson(e.exchangeKey),r=new this(e.id,t,n);return r.createdAt=new Date(e.createdAt),await r.fromJSON(e),r}static async create(e,t=0,n=0){const r=await z.generateKeyPair("ECDSA"),i=await z.generateKeyPair("ECDH"),s=new W(e,r,i);s.createdAt=new Date;for(let e=0;e<n;e++)s.preKeys.push(await z.generateKeyPair("ECDH"));for(let e=0;e<t;e++)s.signedPreKeys.push(await z.generateKeyPair("ECDH"));return s}async toJSON(){const e=[],t=[];for(const t of this.preKeys)e.push(await z.ecKeyPairToJson(t));for(const e of this.signedPreKeys)t.push(await z.ecKeyPairToJson(e));return{createdAt:this.createdAt.toISOString(),exchangeKey:await z.ecKeyPairToJson(this.exchangeKey),id:this.id,preKeys:e,signedPreKeys:t,signingKey:await z.ecKeyPairToJson(this.signingKey)}}async fromJSON(e){this.id=e.id,this.signingKey=await z.ecKeyPairFromJson(e.signingKey),this.exchangeKey=await z.ecKeyPairFromJson(e.exchangeKey),this.preKeys=[];for(const t of e.preKeys)this.preKeys.push(await z.ecKeyPairFromJson(t));this.signedPreKeys=[];for(const t of e.signedPreKeys)this.signedPreKeys.push(await z.ecKeyPairFromJson(t))}}class G{static fill(e){const t=new G;return t.fill(e),t}static async fromJSON(e){const t=new this;return await t.fromJSON(e),t}fill(e){this.signingKey=e.signingKey,this.exchangeKey=e.exchangeKey,this.signature=e.signature,this.createdAt=e.createdAt}verify(){return z.verify(this.signingKey,this.exchangeKey.serialize(),this.signature)}async toJSON(){return{createdAt:this.createdAt.toISOString(),exchangeKey:await this.exchangeKey.key,id:this.id,signature:this.signature,signingKey:await this.signingKey.key,thumbprint:await this.signingKey.thumbprint()}}async fromJSON(e){if(this.id=e.id,this.signature=e.signature,this.signingKey=await Y.create(e.signingKey),this.exchangeKey=await Y.create(e.exchangeKey),this.createdAt=new Date(e.createdAt),!await this.verify())throw new Error("Error: Wrong signature for RemoteIdentity")}}let Z=class extends N{};j([D({id:0,type:"uint32",defaultValue:1})],Z.prototype,"version",void 0),Z=j([B({name:"Base"})],Z);class X{static async set(e){return new Uint8Array(e.serialize())}static async get(e){return Y.importKey(e.buffer,"ECDSA")}}class Q{static async set(e){return new Uint8Array(e.serialize())}static async get(e){return Y.importKey(e.buffer,"ECDH")}}var ee;let te=ee=class extends Z{static async fill(e){const t=new ee;return await t.fill(e),t}async sign(e){this.signature=await z.sign(e,this.exchangeKey.serialize())}async verify(){return await z.verify(this.signingKey,this.exchangeKey.serialize(),this.signature)}async fill(e){this.signingKey=e.signingKey.publicKey,this.exchangeKey=e.exchangeKey.publicKey,this.createdAt=e.createdAt,await this.sign(e.signingKey.privateKey)}};j([D({id:1,converter:X})],te.prototype,"signingKey",void 0),j([D({id:2,converter:Q})],te.prototype,"exchangeKey",void 0),j([D({id:3})],te.prototype,"signature",void 0),j([D({id:4,converter:class{static async set(e){return new Uint8Array(K.a.FromString(e.toISOString()))}static async get(e){return new Date(K.a.ToString(e))}}})],te.prototype,"createdAt",void 0),te=ee=j([B({name:"Identity"})],te);let ne=class extends Z{};j([D({id:1,converter:Q,required:!0})],ne.prototype,"senderRatchetKey",void 0),j([D({id:2,type:"uint32",required:!0})],ne.prototype,"counter",void 0),j([D({id:3,type:"uint32",required:!0})],ne.prototype,"previousCounter",void 0),j([D({id:4,converter:R,required:!0})],ne.prototype,"cipherText",void 0),ne=j([B({name:"Message"})],ne);let re=class extends Z{async sign(e){this.signature=await this.signHMAC(e)}async verify(e){const t=await this.signHMAC(e);return Object(K.d)(t,this.signature)}async getSignedRaw(){const e=this.receiverKey.serialize(),t=this.senderKey.serialize(),n=await this.message.exportProto();return Object(K.c)(e,t,n)}async signHMAC(e){const t=await this.getSignedRaw();return await V.sign(e,t)}};j([D({id:1,converter:X,required:!0})],re.prototype,"senderKey",void 0),j([D({id:2,parser:ne,required:!0})],re.prototype,"message",void 0),j([D({id:3,required:!0})],re.prototype,"signature",void 0),re=j([B({name:"MessageSigned"})],re);let ie=class extends Z{};j([D({id:1,type:"uint32",required:!0})],ie.prototype,"registrationId",void 0),j([D({id:2,type:"uint32"})],ie.prototype,"preKeyId",void 0),j([D({id:3,type:"uint32",required:!0})],ie.prototype,"preKeySignedId",void 0),j([D({id:4,converter:Q,required:!0})],ie.prototype,"baseKey",void 0),j([D({id:5,parser:te,required:!0})],ie.prototype,"identity",void 0),j([D({id:6,parser:re,required:!0})],ie.prototype,"signedMessage",void 0),ie=j([B({name:"PreKeyMessage"})],ie);let se=class extends Z{};j([D({id:1,type:"uint32",required:!0})],se.prototype,"id",void 0),j([D({id:2,converter:Q,required:!0})],se.prototype,"key",void 0),se=j([B({name:"PreKey"})],se);let oe=class extends se{async sign(e){this.signature=await z.sign(e,this.key.serialize())}verify(e){return z.verify(e,this.key.serialize(),this.signature)}};j([D({id:3,converter:R,required:!0})],oe.prototype,"signature",void 0),oe=j([B({name:"PreKeySigned"})],oe);let ae=class extends Z{};j([D({id:1,type:"uint32",required:!0})],ae.prototype,"registrationId",void 0),j([D({id:2,parser:te,required:!0})],ae.prototype,"identity",void 0),j([D({id:3,parser:se})],ae.prototype,"preKey",void 0),j([D({id:4,parser:oe,required:!0})],ae.prototype,"preKeySigned",void 0),ae=j([B({name:"PreKeyBundle"})],ae);const ce=new Uint8Array([1]).buffer,ue=new Uint8Array([2]).buffer;class he{constructor(e){this.counter=0,this.rootKey=e}static async fromJSON(e){const t=new this(e.rootKey);return t.fromJSON(e),t}async toJSON(){return{counter:this.counter,rootKey:this.rootKey}}async fromJSON(e){this.counter=e.counter,this.rootKey=e.rootKey}async calculateKey(e){const t=await V.sign(e,ce),n=await V.sign(e,ue);return{cipher:t,rootKey:await V.importHMAC(n)}}async click(){const e=this.rootKey,t=await this.calculateKey(e);return this.rootKey=t.rootKey,this.counter++,t.cipher}}class le extends he{async encrypt(e){const t=await this.click(),n=await V.HKDF(t,3,void 0,q),r=await V.importAES(n[0]),i=await V.importHMAC(n[1]),s=n[2].slice(0,16);return{cipherText:await V.encrypt(r,e,s),hmacKey:i}}}class fe extends he{constructor(){super(...arguments),this.keys=[]}async toJSON(){const e=await super.toJSON();return e.keys=this.keys,e}async fromJSON(e){await super.fromJSON(e),this.keys=e.keys}async decrypt(e,t){const n=await this.getKey(t),r=await V.HKDF(n,3,void 0,q),i=await V.importAES(r[0]),s=await V.importHMAC(r[1]),o=r[2].slice(0,16);return{cipherText:await V.decrypt(i,e,o),hmacKey:s}}async getKey(e){for(;this.counter<=e;){const e=await this.click();this.keys.push(e)}return this.keys[e]}}class pe extends M.EventEmitter{constructor(){super(),this.counter=0,this.currentStep=new de,this.steps=new ye(20),this.promises={}}static async create(e,t){let n;const r=new pe;if(t instanceof ae){if(!await t.identity.verify())throw new Error("Error: Remote client's identity key is invalid.");if(!await t.preKeySigned.verify(t.identity.signingKey))throw new Error("Error: Remote client's signed prekey is invalid.");r.currentRatchetKey=await r.generateRatchetKey(),r.currentStep.remoteRatchetKey=t.preKeySigned.key,r.remoteIdentity=G.fill(t.identity),r.remoteIdentity.id=t.registrationId,r.remotePreKeyId=t.preKey.id,r.remotePreKeySignedId=t.preKeySigned.id,n=await async function(e,t,n,r,i){const s=await z.deriveBytes(e.exchangeKey.privateKey,r),o=await z.deriveBytes(t.privateKey,n),a=await z.deriveBytes(t.privateKey,r);let c=new ArrayBuffer(0);i&&(c=await z.deriveBytes(t.privateKey,i));const u=new Uint8Array(32);for(let e=0;e<u.length;e++)u[e]=255;const h=u.buffer,l=Object(K.c)(h,s,o,a,c),f=await V.HKDF(l,1,void 0,U);return await V.importHMAC(f[0])}(e,r.currentRatchetKey,t.identity.exchangeKey,t.preKeySigned.key,t.preKey.key)}else{if(!await t.identity.verify())throw new Error("Error: Remote client's identity key is invalid.");const i=e.signedPreKeys[t.preKeySignedId];if(!i)throw new Error(`Error: PreKey with id ${t.preKeySignedId} not found`);let s;void 0!==t.preKeyId&&(s=e.preKeys[t.preKeyId]),r.remoteIdentity=G.fill(t.identity),r.currentRatchetKey=i,n=await async function(e,t,n,r,i){const s=await z.deriveBytes(t.privateKey,n),o=await z.deriveBytes(e.exchangeKey.privateKey,r),a=await z.deriveBytes(t.privateKey,r);let c=new ArrayBuffer(0);i&&(c=await z.deriveBytes(i,r));const u=new Uint8Array(32);for(let e=0;e<u.length;e++)u[e]=255;const h=u.buffer,l=Object(K.c)(h,s,o,a,c),f=await V.HKDF(l,1,void 0,U);return await V.importHMAC(f[0])}(e,r.currentRatchetKey,t.identity.exchangeKey,t.signedMessage.message.senderRatchetKey,s&&s.privateKey)}return r.identity=e,r.id=e.id,r.rootKey=n,r}static async fromJSON(e,t,n){const r=new pe;return r.identity=e,r.remoteIdentity=t,await r.fromJSON(n),r}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}async decrypt(e){return this.queuePromise("encrypt",async()=>{const t=e.message.senderRatchetKey,n=e.message;if(e.message.previousCounter<this.counter-20)throw new Error("Error: Too old message");let r=this.steps.getStep(t);if(!r){const e=new de;e.remoteRatchetKey=t,this.steps.push(e),this.currentStep=e,r=e}r.receivingChain||(r.receivingChain=await this.createChain(this.currentRatchetKey.privateKey,t,fe));const i=await r.receivingChain.decrypt(n.cipherText,n.counter);if(this.update(),e.senderKey=this.remoteIdentity.signingKey,e.receiverKey=this.identity.signingKey.publicKey,!await e.verify(i.hmacKey))throw new Error("Error: The Message did not successfully verify!");return i.cipherText})}async encrypt(e){return this.queuePromise("encrypt",async()=>{if(this.currentStep.receivingChain&&!this.currentStep.sendingChain&&(this.counter++,this.currentRatchetKey=await this.generateRatchetKey()),!this.currentStep.sendingChain){if(!this.currentStep.remoteRatchetKey)throw new Error("currentStep has empty remoteRatchetKey");this.currentStep.sendingChain=await this.createChain(this.currentRatchetKey.privateKey,this.currentStep.remoteRatchetKey,le)}const t=await this.currentStep.sendingChain.encrypt(e);let n;this.update(),0!==this.steps.length||this.currentStep.receivingChain||1!==this.currentStep.sendingChain.counter||(n=new ie,n.registrationId=this.identity.id,n.preKeyId=this.remotePreKeyId,n.preKeySignedId=this.remotePreKeySignedId,n.baseKey=this.currentRatchetKey.publicKey,await n.identity.fill(this.identity));const r=new re;return r.receiverKey=this.remoteIdentity.signingKey,r.senderKey=this.identity.signingKey.publicKey,r.message.cipherText=t.cipherText,r.message.counter=this.currentStep.sendingChain.counter-1,r.message.previousCounter=this.counter,r.message.senderRatchetKey=this.currentRatchetKey.publicKey,await r.sign(t.hmacKey),n?(n.signedMessage=r,n):r})}async hasRatchetKey(e){let t;t=e instanceof Y?e:await Y.create(e);for(const e of this.steps.items)if(await e.remoteRatchetKey.isEqual(t))return!0;return!1}async toJSON(){return{counter:this.counter,ratchetKey:await z.ecKeyPairToJson(this.currentRatchetKey),remoteIdentity:await this.remoteIdentity.signingKey.thumbprint(),rootKey:this.rootKey,steps:await this.steps.toJSON()}}async fromJSON(e){this.currentRatchetKey=await z.ecKeyPairFromJson(e.ratchetKey),this.counter=e.counter,this.rootKey=e.rootKey;for(const t of e.steps)this.currentStep=await de.fromJSON(t),this.steps.push(this.currentStep)}update(){this.emit("update")}generateRatchetKey(){return z.generateKeyPair("ECDH")}async createChain(e,t,n){const r=await z.deriveBytes(e,t),i=await V.HKDF(r,2,this.rootKey,J),s=await V.importHMAC(i[0]),o=new n(await V.importHMAC(i[1]));return this.rootKey=s,o}queuePromise(e,t){const n=this.promises[e]||Promise.resolve(),r=this.promises[e]=n.then(t,t);return r.then(()=>{this.promises[e]===r&&delete this.promises[e]}),r}}class de{static async fromJSON(e){const t=new this;return await t.fromJSON(e),t}async toJSON(){const e={};return this.remoteRatchetKey&&(e.remoteRatchetKey=this.remoteRatchetKey.key),this.sendingChain&&(e.sendingChain=await this.sendingChain.toJSON()),this.receivingChain&&(e.receivingChain=await this.receivingChain.toJSON()),e}async fromJSON(e){e.remoteRatchetKey&&(this.remoteRatchetKey=await Y.create(e.remoteRatchetKey)),e.sendingChain&&(this.sendingChain=await le.fromJSON(e.sendingChain)),e.receivingChain&&(this.receivingChain=await fe.fromJSON(e.receivingChain))}}class ye extends class{constructor(e=20){this.items=[],this.maxSize=e}get length(){return this.items.length}get latest(){return this.items[this.length-1]}push(e){this.length===this.maxSize&&(this.items=this.items.slice(1)),this.items.push(e)}async toJSON(){const e=[];for(const t of this.items)e.push(await t.toJSON());return e}async fromJSON(e){this.items=e}}{getStep(e){let t;return this.items.some(n=>(n.remoteRatchetKey.id===e.id&&(t=n),!!t)),t}}class ge{updateLink(e){this.logId=e.logId,this.asymmetricRatchet=e.asymmetricRatchet}static async fromJSON(e){let t=new ge;return t.name=e.name,t.logId=e.logId,t.deviceId=e.deviceId,t.asymmetricRatchet=await pe.fromJSON(await W.fromJSON(e.identity),await G.fromJSON(e.remoteIdentity),e.asymmetricRatchet),t}async toJSON(){return{deviceId:this.deviceId,logId:this.logId,name:this.name,asymmetricRatchet:await this.asymmetricRatchet.toJSON(),identity:await this.asymmetricRatchet.identity.toJSON(),remoteIdentity:await this.asymmetricRatchet.remoteIdentity.toJSON()}}}function ve(e){let t=new Uint8Array(e),n=t.byteLength;return window.btoa(String.fromCharCode.apply(null,t.subarray(0,n))).replace(/\=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class me{constructor(e,t,n,r,i){this.signingKey=e,this.logId=t,this.sequence=n,this.persistence=r,this.messageEncoder=i}async addMessage(e){let t=this.sequence+1,n=await this.createLogMessage(e,await this.getPreviousHash(),t);await this.persistence.storeMessages(this.logId,[n]),this.sequence=t}async getPreviousHash(){if(0==this.sequence)return"initial";return(await this.persistence.getLastMessage(this.logId)).hash}async createLogMessage(e,t,n){let r=+new Date,i=await async function(e,t,n){let r=(new TextEncoder).encode(`${n}.${e}`),i=new Uint8Array(t),s=new Uint8Array(r.length+i.length);return s.set(r),s.set(i,r.length),{encodedContent:r,digest:await crypto.subtle.digest("SHA-256",r)}}(t,e,r),s=await crypto.subtle.sign({name:"ECDSA",hash:"SHA-256"},this.signingKey,i.encodedContent);return new _(e,ve(i.digest),t,ve(s),r,n)}getAll(){return this.persistence.getAll(this.logId)}}class we{}class be{constructor(e,t){this.persistence=e,this.messageEncoder=t}async appendOnlyLogCreated(e){return await this.persistence.hasAppendOnlyLog(e)}async getLogId(e){return(await crypto.subtle.exportKey("jwk",e.publicKey)).x}async create(){let e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"]),t=await this.getLogId(e);await this.persistence.createAppendOnlyLog(t,e.publicKey,e.privateKey);let n=new me(e.privateKey,t,0,this.persistence,this.messageEncoder);return await n.addMessage(this.messageEncoder.encodePublicKeyMessage(e.publicKey)),t}async requireFirstTimeInit(){return null==await this.persistence.getAppendOnlyLogState()}async initialize(){if(this.appendOnlyLogState=await this.persistence.getAppendOnlyLogState(),null==this.appendOnlyLogState){this.appendOnlyLogState=new we;let e=await this.create();this.appendOnlyLogState.currentLogId=e,await this.persistence.storeAppendOnlyLogState(this.appendOnlyLogState)}}getCurrentLogId(){return this.appendOnlyLogState.currentLogId}async getCurrentLog(){let e=await this.persistence.getAppendOnlyLog(this.appendOnlyLogState.currentLogId);return new me(e.privateKey,this.appendOnlyLogState.currentLogId,e.sequence,this.persistence,this.messageEncoder)}}class Ae{}class Se{async storeNote(e){const t=this.db.transaction("Notes","readwrite");await t.store.put({id:e.id,content:e.content}),await t.done}async getAllNotes(){return(await this.db.getAll("Notes")).map(e=>{let t=new Ae;return t.id=e.id,t.content=e.content,t})}async storeAppendOnlyLogState(e){const t=this.db.transaction("ApplicationSettings","readwrite");await t.store.put({currentLogId:e.currentLogId,key:"appendOnlyLogState"}),await t.done}async getAppendOnlyLogState(){let e=await this.db.get("ApplicationSettings","appendOnlyLogState");if(null==e)return null;let t=new we;return t.currentLogId=e.currentLogId,t}async getLinkedDevices(){let e=(await this.db.getAll("LinkedDevices")).map(e=>ge.fromJSON(e));return Promise.all(e)}async storeLinkedDevice(e){let t=await e.toJSON();const n=this.db.transaction("LinkedDevices","readwrite");await n.store.put(t),await n.done}async getDeviceLinkIdentity(){let e=await this.db.get("ApplicationSettings","deviceLinkIdentity");if(null==e)return null;let t=new T;return t.id=e.id,t}async storeDeviceLinkIdentity(e){const t=this.db.transaction("ApplicationSettings","readwrite");await t.store.put({id:e.id,key:"deviceLinkIdentity"}),await t.done}async getAppendOnlyLog(e){let t=await this.db.get("AppendOnlyLogs",e);return{logId:e,privateKey:t.privateKey,publicKey:t.publicKey,sequence:t.sequence}}async getLastMessage(e){let t=await this.db.get("AppendOnlyLogs",e);if(null==t.last)return null;let n=await this.db.get("AppendOnlyLogMessages",[e,t.last]);return new _(n.content,n.hash,n.previous,n.signature,n.timestamp,n.sequence)}async storeMessages(e,t){let n=await this.db.get("AppendOnlyLogs",e);const r=this.db.transaction("AppendOnlyLogMessages","readwrite");let{last:i}=n,s=null;for(let n of t){let t={...n,logId:e,previous:i};await r.store.add(t),i=t.hash,s=t.sequence}return await r.done,n.last=i,n.sequence=s,await this.db.put("AppendOnlyLogs",n),!0}async initialize(){this.db=await function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=v(o);return r&&o.addEventListener("upgradeneeded",e=>{r(v(o.result),e.oldVersion,e.newVersion,v(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),a}("greenchat-dbv2",8,{upgrade(e,t,n){if(t<8&&e.createObjectStore("Notes",{keyPath:"id"}),t<6&&e.createObjectStore("LinkedDevices",{keyPath:"deviceId"}),t<5&&(t>3&&e.deleteObjectStore("ApplicationSettings"),e.createObjectStore("ApplicationSettings",{keyPath:"key"})),t<7){t>0&&(e.deleteObjectStore("AppendOnlyLogMessages"),e.deleteObjectStore("AppendOnlyLogs")),e.createObjectStore("AppendOnlyLogMessages",{keyPath:["logId","hash"]}).createIndex("logId","logId"),e.createObjectStore("AppendOnlyLogs",{keyPath:"id"})}}})}async hasAppendOnlyLog(e){return!!await this.db.get("AppendOnlyLogs",e)}async createAppendOnlyLog(e,t,n){await this.db.add("AppendOnlyLogs",{id:e,privateKey:n,publicKey:t,sequence:0,last:null})}async addMessage(e,t){let n=await this.db.get("AppendOnlyLogs",e),r={...t,logId:e};await this.db.add("AppendOnlyLogMessages",r),n.last=r.hash,n.sequence=r.sequence,await this.db.put("AppendOnlyLogs",n)}async*getAll(e){const t=this.db.transaction("AppendOnlyLogMessages").store.index("logId");for await(const n of t.iterate(e)){let e=n.value;yield new _(e.content,e.hash,e.previous,e.signature,e.timestamp,e.sequence)}}}var Oe=n(30),ke=n.n(Oe);class Ee extends HTMLElement{constructor(){super(),this.innerHTML=ke.a}connectedCallback(){}}customElements.define("app-first-time-init",Ee);var Ce=n(31),Le=n.n(Ce);class Ie extends HTMLElement{constructor(){super(),this.innerHTML=Le.a}addServices(e){this.store=e.store,this.notesActionCreator=e.notesActionCreator,this.routingActionCreator=e.routingActionCreator}connectedCallback(){this.list=this.querySelector("#notes-list"),this.noteContent=this.querySelector("#note-content"),this.querySelector("#addNoteBtn").addEventListener("click",()=>{this.notesActionCreator.takeNote(this.noteContent.value),this.noteContent.value=""}),this.querySelectorAll("a").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),this.routingActionCreator.navigate(e.getAttribute("href"))})}),this.subscription=this.store.subscribe("notes",e=>this.applyStoreState(e)),this.applyStoreState(this.store.state),this.notesActionCreator.loadNotes()}applyStoreState(e){this.list.innerHTML="";for(let t of e.notes.notes){let e=document.createElement("li");e.innerText=t,this.list.appendChild(e)}}disconnectedCallback(){this.subscription()}}customElements.define("app-home",Ie);var xe=n(32),_e=n.n(xe),Te=n(33),Ke=n.n(Te);class je extends HTMLElement{constructor(){super(),this.innerHTML=Ke.a,this.generateButtonListener=()=>{this.dispatchEvent(new CustomEvent("ongenerate"))},this.pastebuttonListener=()=>{this.dispatchEvent(new CustomEvent("oncodereceived",{detail:this.pastedCode.value}))}}set inviteCode(e){this.invCode.innerText=e,this.applyState(e)}applyState(e){e?(this.processStartPane.style.display="none",this.invitePane.style.display="block"):(this.invitePane.style.display="none",this.processStartPane.style.display="block")}connectedCallback(){this.invitePane=this.querySelector("#invite-code-pane"),this.processStartPane=this.querySelector("#process-start-pane"),this.generateButton=this.querySelector("#generate"),this.pasteButton=this.querySelector("#redeem-code"),this.invCode=this.querySelector("#inv-code"),this.pastedCode=this.querySelector("#pasted-code"),this.applyState(this.inviteCode),this.generateButton.addEventListener("click",this.generateButtonListener),this.pasteButton.addEventListener("click",this.pastebuttonListener)}disconnectedCallback(){this.generateButton.removeEventListener("click",this.generateButtonListener),this.pasteButton.removeEventListener("click",this.pastebuttonListener)}}customElements.define("app-start-device-linking",je);class Pe extends HTMLElement{constructor(){super(),this.innerHTML=_e.a}addServices(e){this.store=e.store,this.deviceLinkActionCreator=e.deviceLinkActionCreator}connectedCallback(){this.startDeviceLinking=new je,this.appendChild(this.startDeviceLinking),this.startDeviceLinking.addEventListener("ongenerate",async()=>{await this.deviceLinkActionCreator.startDeviceLinking()}),this.startDeviceLinking.addEventListener("oncodereceived",async e=>{await this.deviceLinkActionCreator.linkDevice(e.detail)}),this.subscription=this.store.subscribe("deviceLink",e=>this.applyStoreState(e)),this.applyStoreState(this.store.state),this.deviceLinkActionCreator.initializeDeviceLinking()}applyStoreState(e){this.startDeviceLinking.inviteCode=e.deviceLink.inviteCode}disconnectedCallback(){this.subscription()}}customElements.define("app-link-device",Pe);var Re,Be,De,Ne,Me=n(34),Ue=n.n(Me);class Je extends HTMLElement{constructor(){super(),this.innerHTML=Ue.a}async connectedCallback(){let e=await fetch("main.licenses.txt"),t=await e.text();this.querySelector("#third-party").innerText=t}}customElements.define("app-open-source-info",Je),function(e){e.FirstTimeInit="first-time-init",e.LinkDevice="link-device",e.OpenSourceInfo="open-source-info",e.Home=""}(Re||(Re={}));class qe{setServiceLocator(e){this.serviceLocator=e}resolve(e,t,n){switch(t){case Re.FirstTimeInit:return new Ee;case Re.OpenSourceInfo:return new Je;case Re.LinkDevice:{let e=new Pe;return e.addServices(this.serviceLocator),e}default:let e=new Ie;return e.addServices(this.serviceLocator),e}}}class Fe extends class{constructor(e){this.subscriptions=[],this.reducerSubscriptions=[],this.state=e()}subscribe(e,t){let n={area:e,call:t};return this.subscriptions.push(n),()=>{this.subscriptions.splice(this.subscriptions.indexOf(n),1)}}addReducer(e,t){this.reducerSubscriptions.push({area:e,reducer:t})}dispatch(e){let t=[];for(let n of this.reducerSubscriptions){let r;r=n.area?e=>{this.state[n.area]=e(this.state[n.area]),t.push(n.area)}:e=>{this.state=e(this.state),t.push("")},n.reducer.onDispatch(e,r)}if(t.length)for(let e of this.subscriptions)(!e.area||t.indexOf(e.area)>-1)&&e.call(this.state)}}{}class He{constructor(e,t,n,r){this.store=e,this.localAppendOnlyLogService=t,this.routingActionCreator=n,this.deviceLinkService=r}async initializeAppendOnlyLog(e){await this.localAppendOnlyLogService.requireFirstTimeInit()&&e.require(),await this.localAppendOnlyLogService.initialize()}async initializeApplication(){let e=!1,t={require:()=>{e||(e=!0,this.routingActionCreator.navigateFirstTimeInit())}};await this.initializeAppendOnlyLog(t),await this.deviceLinkService.initialize(),e&&this.routingActionCreator.navigateHome()}}!function(e){e.PublicKey="PublicKey",e.Note="Note"}(Be||(Be={})),function(e){e[e.Public=1]="Public",e[e.Private=2]="Private"}(De||(De={}));class ze{constructor(){this.encoder=new TextEncoder}encodePublicKeyMessage(e){let t={publicKey:e,type:Be.PublicKey},n=this.encoder.encode(JSON.stringify(t)),r=new Uint8Array(n.length+2);return new DataView(r.buffer).setInt32(0,De.Public,!0),r.set(n,2),r.buffer}async encodeNote(e,t){let n={id:e.id,content:e.content,type:Be.Note},r=this.encoder.encode(JSON.stringify(n)),i=new Uint8Array(await t.encrypt(r)),s=new Uint8Array(i.length+2);return new DataView(s.buffer).setInt32(0,De.Private,!0),s.set(i,2),s.buffer}}class $e{constructor(e){this.router=e}navigateFirstTimeInit(){this.router.navigate(Re.FirstTimeInit,null)}navigateHome(){this.router.navigate(Re.Home,null)}navigate(e){this.router.navigate(e,null)}}function Ve(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}!function(e){e.TakeNote="TakeNote",e.NotesLoaded="NotesLoaded"}(Ne||(Ne={}));class Ye{constructor(e){this.note=e,this.type=Ne.TakeNote}}class We{constructor(e){this.notes=e,this.type=Ne.NotesLoaded}}class Ge{constructor(e,t,n,r,i){this.store=e,this.localAppendOnlyLogService=t,this.messageEncoder=n,this.deviceLinkService=r,this.notePersistence=i}async takeNote(e){let t=new Ae;t.id=Ve(),t.content=e;let n=await this.localAppendOnlyLogService.getCurrentLog(),r=this.deviceLinkService.getMessageEncryptors();for(let e of r)await n.addMessage(await this.messageEncoder.encodeNote(t,e));await this.notePersistence.storeNote(t),this.store.dispatch(new Ye(t))}async loadNotes(){let e=await this.notePersistence.getAllNotes();this.store.dispatch(new We(e))}}class Ze{onDispatch(e,t){switch(e.type){case Ne.TakeNote:t(t=>{let n=t.notes||[];return n.push(e.note.content),{...t,notes:n}});break;case Ne.NotesLoaded:t(t=>({...t,notes:e.notes.map(e=>e.content)}))}}}class Xe{constructor(e,t,n,r){this.store=e,this.notesActionCreator=t,this.deviceLinkActionCreator=n,this.routingActionCreator=r}}const Qe={iceServers:[{urls:["turn:turn.greenchat.me:443"],username:"raphael",credential:"@123@test@"}]};class et{constructor(e,t){this.connectionId=e,this.signallingClient=t}addIceCandidate(e){this.rtcConnection.addIceCandidate(e)}setAnswer(e){this.rtcConnection.setRemoteDescription(e)}acknowledgeInit(){this.resolveInit()}setOffer(e){this.resolveConnectionRequest(e)}rejectConenctionRequest(e){this.rejectConnectionRequest(e)}initiateChannel(e){return this.initiateConnection(e)}initiateConnection(e,t){this.rtcConnection=new RTCPeerConnection({...Qe});let n=this.rtcConnection.createDataChannel("sendChannel");return this.rtcConnection.onicecandidate=({candidate:e})=>{e&&this.signallingClient.publishIceCandidate(this.connectionId,e)},this.rtcConnection.createOffer().then(n=>{t?this.signallingClient.connectHub(t,this.connectionId,e,n):this.signallingClient.initiateConnection(this.connectionId,e,n),this.rtcConnection.setLocalDescription(n)}),new Promise((e,t)=>{let r=!1;this.resolveInit=()=>{r=!0,e(n)},setTimeout(()=>{r||(t("Timeout"),this.rtcConnection.close())},2e3)})}connectHub(e,t){return this.initiateConnection(t,e)}openChannel(){this.rtcConnection=new RTCPeerConnection({...Qe}),this.rtcConnection.onicecandidate=({candidate:e})=>{e&&this.signallingClient.publishIceCandidate(this.connectionId,e)};let e=new Promise(e=>{this.resolveConnectionRequest=t=>{this.rtcConnection.setRemoteDescription(t).then(()=>{this.rtcConnection.createAnswer().then(t=>{this.rtcConnection.setLocalDescription(t),this.signallingClient.sendAnswer(this.connectionId,t),e()})})}});return this.signallingClient.requestConnection(this.connectionId),new Promise((t,n)=>{let r=!1;this.rtcConnection.ondatachannel=n=>{let i=n.channel;e.then(()=>{r||(r=!0,t(i))})},this.rejectConenctionRequest=e=>{r=!0,n(e),this.rtcConnection.close()},setTimeout(()=>{r||(n("Timeout"),this.rtcConnection.close())},1e4)})}}class tt{}class nt{constructor(e){this.signallingClient=e}getHubs(){return new Promise(e=>{this.resolveHubs=()=>{this.resolveHubs=null,e(this.hubs)},this.signallingClient.getHubs()})}async connectHub(){let e=await this.getHubs();if(!e.length)throw new tt;let t=e[Math.floor(Math.random()*e.length)],n=new et(Ve(),this.signallingClient);this.signallingClient.addHandler(n);let r=await n.connectHub(t,12e4);return{connectionHandler:n,rtcDataChannel:r}}setHubs(e){this.hubs=e,this.resolveHubs&&this.resolveHubs()}}class rt extends EventTarget{constructor(e){super(),this.signallingClient=e}requestConnection(e){let t=new et(e,this.signallingClient);this.signallingClient.addHandler(t),t.openChannel().then(e=>{let n={connectionHandler:t,rtcDataChannel:e};this.dispatchEvent(new CustomEvent("onincomingclient",{detail:n}))})}}class it extends EventTarget{constructor(){super(),this.localId=Ve(),this.handlers=[],this.hubConnector=new nt(this)}connect(){return new Promise(e=>{let t=this,n=this.socket=new WebSocket("wss://hub.greenchat.me");n.onopen=function(){n.send(JSON.stringify({type:"connected",id:t.localId})),this.dispatchEvent(new Event("connected")),e()},n.onerror=function(e){console.log("WebSocket Error "+e),n.close()},n.onclose=function(e){console.log("Socket is closed. Reconnect will be attempted in 1 second.",e.reason),this.dispatchEvent(new Event("disconnected")),setTimeout((function(){t.connect()}),1e3)},n.onmessage=function(e){let n=JSON.parse(e.data);switch(n.type){case"connection_initialized":t.handlers.find(e=>e.connectionId===n.connectionId).acknowledgeInit();break;case"connection_offer":t.handlers.find(e=>e.connectionId===n.connectionId).setOffer(n.offer);break;case"connection_accepted":t.handlers.find(e=>e.connectionId===n.connectionId).setAnswer(n.answer);break;case"connection_not_found":t.handlers.find(e=>e.connectionId===n.connectionId).rejectConenctionRequest("Not found");break;case"new_ice_candidate":t.handlers.find(e=>e.connectionId===n.connectionId).addIceCandidate(n.candidate);break;case"hubs":t.hubConnector.setHubs(n.hubs);break;case"connect_hub":t.hubController.requestConnection(n.connectionId)}}})}getHubConnector(){return this.hubConnector}createHub(){return this.socket.send(JSON.stringify({type:"announce_hub"})),this.hubController=new rt(this),this.hubController}async initializeDeviceLinkChannel(e){let t=new et(Ve(),this);this.addHandler(t);let n=await t.initiateChannel(e);return{connectionHandler:t,rtcDataChannel:n}}async openDeviceLinkChannel(e){let t=new et(e,this);this.addHandler(t);let n=await t.openChannel();return{connectionHandler:t,rtcDataChannel:n}}requestConnection(e){this.socket.send(JSON.stringify({type:"request_connection",connectionId:e}))}sendAnswer(e,t){this.socket.send(JSON.stringify({type:"accept_connection",connectionId:e,answer:t}))}initiateConnection(e,t,n){this.socket.send(JSON.stringify({type:"initialize_connection",connectionId:e,timeout:t,offer:n}))}getHubs(){this.socket.send(JSON.stringify({type:"get_hubs"}))}publishIceCandidate(e,t){this.socket.send(JSON.stringify({type:"new_ice_candidate",candidate:t,id:this.localId,connectionId:e}))}connectHub(e,t,n,r){this.socket.send(JSON.stringify({type:"connect_hub",connectionId:t,timeout:n,offer:r,hubId:e}))}addHandler(e){this.handlers.push(e)}}var st,ot,at;!function(e){e.SignallingConnectionChanged="SignallingConnectionChanged"}(st||(st={}));class ct{constructor(e){this.connected=e,this.type=st.SignallingConnectionChanged}}class ut{constructor(e,t){this.store=e,this.signallingClient=t,this.signallingClient.addEventListener("connected",()=>{this.store.dispatch(new ct(!0))}),this.signallingClient.addEventListener("disconnected",()=>{this.store.dispatch(new ct(!1))})}async startSignalling(){await this.signallingClient.connect();let e=this.signallingClient.getHubConnector();try{await e.connectHub()}catch(e){if(e instanceof tt){this.signallingClient.createHub().addEventListener("onincomingclient",e=>{e.detail})}}}}class ht{onDispatch(e,t){switch(e.type){case st.SignallingConnectionChanged:t(t=>({...t,signallingConnected:e.connected}))}}}!function(e){e[e.Started=0]="Started",e[e.Succeeded=1]="Succeeded",e[e.Error=2]="Error",e[e.Initialized=3]="Initialized"}(ot||(ot={})),function(e){e.DeviceLinkingInitialized="DeviceLinkingInitialized",e.DeviceLinkChannelInitialized="DeviceLinkChannelInitialized",e.DeviceLinkStatusChanged="DeviceLinkStatusChanged"}(at||(at={}));class lt{constructor(e,t){this.connectionId=e,this.identitySigningPublicKey=t,this.type=at.DeviceLinkChannelInitialized}}class ft{constructor(e){this.status=e,this.type=at.DeviceLinkStatusChanged}}class pt{constructor(){this.type=at.DeviceLinkingInitialized}}class dt{constructor(e,t){this.store=e,this.deviceLinkingService=t}initializeDeviceLinking(){this.store.dispatch(new pt)}async startDeviceLinking(){let e=await this.deviceLinkingService.startDeviceLinking();this.store.dispatch(new lt(e.connectionId,e.identitySigningPublicKey))}async linkDevice(e){try{await this.deviceLinkingService.linkDevice(e)}catch(e){this.store.dispatch(new ft(ot.Error))}}}class yt{onDispatch(e,t){switch(e.type){case at.DeviceLinkingInitialized:t(e=>({...e,inviteCode:null,deviceLinkStatus:ot.Initialized}));break;case at.DeviceLinkChannelInitialized:t(t=>({...t,inviteCode:`["${e.connectionId}","${e.identitySigningPublicKey}"]`,deviceLinkStatus:ot.Started}));break;case at.DeviceLinkStatusChanged:t(t=>({...t,deviceLinkStatus:e.status}))}}}class gt extends EventTarget{constructor(e,t,n,r){super(),this.rtcDataChannel=e,this.deviceId=t,this.logId=n,this.identitySigningPublicKey=r,this.MSG_PREKEYBUNDLE=0,this.MSG_PREKEY_LOCALDETAILS=1,this.MSG_LOCALDETAILS=2,this.attachMessageHandler(),this.linkedDevice=new ge}attachMessageHandler(){this.listener=e=>{this.onmessage(e.data).catch(e=>{console.error(e)})},this.rtcDataChannel.addEventListener("message",this.listener)}async initiate(){this.identity=await W.create(1,1);let e=new ae;await e.identity.fill(this.identity),e.registrationId=this.identity.id;const t=this.identity.signedPreKeys[0];e.preKeySigned.id=0,e.preKeySigned.key=t.publicKey,await e.preKeySigned.sign(this.identity.signingKey.privateKey);let n=await e.exportProto();return"open"!=this.rtcDataChannel.readyState?this.rtcDataChannel.onopen=()=>{this.sendPreKeyBundle(n)}:this.sendPreKeyBundle(n),{identitySigningPublicKey:ve(this.identity.signingKey.publicKey.serialize())}}sendPreKeyBundle(e){let t=new Uint8Array(e.byteLength+1);t[0]=this.MSG_PREKEYBUNDLE,t.set(new Uint8Array(e),1),this.rtcDataChannel.send(t)}async sendLocalDetails(e){let t=new TextEncoder,n=await(await this.linkedDevice.asymmetricRatchet.encrypt(t.encode(JSON.stringify({deviceId:this.deviceId,logId:this.logId})))).exportProto(),r=new Uint8Array(n.byteLength+1);r[0]=e?this.MSG_PREKEY_LOCALDETAILS:this.MSG_LOCALDETAILS,r.set(new Uint8Array(n),1),this.rtcDataChannel.send(r)}async getDeviceDetails(e){let t=await this.linkedDevice.asymmetricRatchet.decrypt(e),n=(new TextDecoder).decode(t),{deviceId:r,logId:i}=JSON.parse(n);this.linkedDevice.logId=i,this.linkedDevice.name=r,this.linkedDevice.deviceId=r}endSession(){this.rtcDataChannel.removeEventListener("message",this.listener),this.dispatchEvent(new CustomEvent("devicelinksuccess",{detail:this.linkedDevice}))}async onmessage(e){let t=new Uint8Array(e),n=t[0];switch(e=t.subarray(1),n){case this.MSG_PREKEYBUNDLE:{const t=await ae.importProto(e);this.identity=await W.create(1,1),await t.preKeySigned.verify(await Y.importKey(function(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;++e)r[e]=n.charCodeAt(e);return r}(this.identitySigningPublicKey),"ECDSA"))&&(this.linkedDevice.asymmetricRatchet=await pe.create(this.identity,t),await this.sendLocalDetails(!0));break}case this.MSG_PREKEY_LOCALDETAILS:{let t=await ie.importProto(e);this.linkedDevice.asymmetricRatchet=await pe.create(this.identity,t),await this.getDeviceDetails(t.signedMessage),await this.sendLocalDetails(!1),this.endSession();break}case this.MSG_LOCALDETAILS:{let t=await re.importProto(e);await this.getDeviceDetails(t),this.endSession();break}default:console.error("Unknown Device Link Message Type "+n)}}}class vt{constructor(e,t,n){this.signallingClient=e,this.persistence=t,this.localAppendOnlyLogService=n}async startDeviceLinking(){let e=await this.signallingClient.initializeDeviceLinkChannel(12e4),t=new gt(e.rtcDataChannel,this.deviceLinkIdentity.id,this.localAppendOnlyLogService.getCurrentLogId());t.addEventListener("devicelinksuccess",async e=>await this.deviceLinkSuccess(e.detail));let n=await t.initiate();return{connectionId:e.connectionHandler.connectionId,identitySigningPublicKey:n.identitySigningPublicKey}}async linkDevice(e){let[t,n]=JSON.parse(e),r=await this.signallingClient.openDeviceLinkChannel(t);new gt(r.rtcDataChannel,this.deviceLinkIdentity.id,this.localAppendOnlyLogService.getCurrentLogId(),n).addEventListener("devicelinksuccess",async e=>await this.deviceLinkSuccess(e.detail))}async deviceLinkSuccess(e){let t=this.linkedDevices.find(t=>e.deviceId==t.deviceId);t?t.updateLink(e):(t=e,this.linkedDevices.push(e)),await this.persistence.storeLinkedDevice(t)}async initialize(){if(this.deviceLinkIdentity=await this.persistence.getDeviceLinkIdentity(),null==this.deviceLinkIdentity){let e=new T;e.id=Ve(),await this.persistence.storeDeviceLinkIdentity(e)}this.linkedDevices=await this.persistence.getLinkedDevices()}getMessageEncryptors(){return this.linkedDevices.map(e=>({encrypt:async t=>{let n=await e.asymmetricRatchet.encrypt(t);return await this.persistence.storeLinkedDevice(e),await n.exportProto()}}))}}(async function(){const e=new Se,t=new it,n=new qe,s=new r(n,new i),o=new Fe(()=>({signallingConnected:!1,notes:{notes:[]},deviceLink:{deviceLinkStatus:null,inviteCode:null}}));o.addReducer("notes",new Ze),o.addReducer(null,new ht),o.addReducer("deviceLink",new yt);const a=new ze,c=new be(e,a),u=new vt(t,e,c),h=new $e(s),l=new He(o,c,h,u),f=new Ge(o,c,a,u,e),p=new ut(o,t),d=new dt(o,u),y=new Xe(o,f,d,h);n.setServiceLocator(y),await e.initialize(),s.run(),await l.initializeApplication(),p.startSignalling()})().catch(e=>console.error(e))}]);
//# sourceMappingURL=5416aaef5cee5b11fb00.bundle.js.map